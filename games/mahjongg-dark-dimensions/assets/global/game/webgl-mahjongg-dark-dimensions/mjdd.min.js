!function(){function e(){e.swipeDistance=160,e.swipeMaxtime=800,e.clickTime=200,e._mouseDownWhen=0,e._mouseSwipeStart=null,e.callbackList=null,e._showDebugWindowData=0,e._debugText=null,window.addEventListener("resize",e.resizeCanvas,!1),window.addEventListener("orientationchange",e.resizeCanvas,!1)}function t(){if("hidden"in document)return null;for(var e=["moz","ms","o","webkit"],t=0;t<e.length;t++){var s=e[t]+"Hidden";if(s in document)return e[t]}return null}function s(e){return e?e+"Hidden":"hidden"}function i(e){return e?e+"visibilitychange":"visibilitychange"}function n(){PIXI.Sprite.call(this),this.x=0,this.y=0,this.anchor.set(0,0),this.responsive=null,this.myFilters=null,this.pickerMaskData=null,this.fader=null,this.tweener=null,this.button=null,this.globalScale=null}function a(e,t){PIXI.Text.call(this,e,t),this.x=0,this.y=0,this.responsive=null}function r(){this.parent=null,this.managers=null,this.bg=null,this.text=null,this.buttons=null,this.callback=null,this.context=null,this.removeContext=null,this.removeArgument=null,this.timeOut=0,this.doneIn=!1,this.doneOut=!1,this.buttonPressed=0,this.removing=!1,this.removeAfterClick=!0,this.adShown=!1}function o(){this.panel=null,this.sprites=null,this.buttons=null,this.texts=null}function l(){this.panel=null,this.sprites=null,this.buttons=null,this.texts=null,this.tab1=null,this.tab2=null,this.whichTab=0,this.checkBox=null}function h(e){n.call(this),this.textures=null,this.type=e||h.TYPE_BUTTON,this.downDetected=!0,this._toggled="on",this.text=null,this.sfx=null,this.sfxHover=null}function u(){this.checked=!1,this.tick=null,this.toggleEvent=null,h.call(this,h.TYPE_CHECKBOX)}function c(){this.panel=null,this.sprites=null,this.buttons=null,this.texts=null,this.soundBtn=null,this.musicBtn=null,this.destroyCallback=null,this.removing=!1,this.doneIn=!1,this.doneOut=!1,this.adShown=!1,this.soundAdjustTracked=!1,this.sliderTab=[],this.sliderBar=[],this.isJPay="jpay"===window.gameType?!0:!1}function d(){this.managers=null,this.puzzle=null,this.hoveredPiece=null,this.dropPiece=null,this.selectedPiece=null,this.chain=0,this.multiMatch=0,this.spriteList=null,this.lastHovered=null,this.userInteractedWithBoard=!1}function p(){this.managers=null}function g(){this.strings=null}function m(e,t,s){P.debug&&console.log("FontLoaded ",e),this.fontList=e,this.loadedCallback=t,this.loadedCallbackContext=s,this.loadedFonts=0,this.width=m.getTextExtent("giItT1WQy@!-/#%","font_that_doesnt_exist",300),this.checkFonts()||(this.interval=setInterval(this.checkFonts.bind(this),50))}function y(){this.fadeValue=0,this.fadedir=0,this.trigger=void 0,this.direction=void 0,this.callback=null,this.context=null,this.args=null}function f(){this.list=null}function v(){this.pending=0,this.loader=null}function b(){}function _(){this.list=null,this.pending=0}function w(){this.list=null,this.mute=!1,this.gameTune=null,this.tunesMuted=!1,this.rememberMute=void 0,this.rememberTunesMuted=void 0,this.delayed=null,this.pending=0,this.managers=null}function x(e,t){void 0!=window.ArenaXApi&&null!=window.ArenaXApi&&(this._arenaXapi=ArenaXApi.init(e,t),this._arenaXapi.dispatch({type:"GAME_REGISTERED",payload:null})),this.testActionCallback=null,void 0!=window.ARK_game_arena_connector&&window.ARK_game_arena_connector.init()}function T(e){this.root=null,this.textureManager=null,this.dataManager=null,this.audioManager=null,this.localeManager=null,this.loadManager=null,this.lowResolution=!1,this.levels=0,this.baseUrl=e,this.isJPay="jpay"===window.gameType?!0:!1}function S(e,t,s,i,a,r,o,l){this.managers=t,this.symbol=r,this.value=o,this.timer=1e3*l,this.name="cube_"+this.symbol+"_1",n.call(this),this.create(e,null,this.name,this.managers.textures),this.setPickerData(this.managers.data.get("maskData_1")),this.anchor.set(.5,.5),this.scale.x=S.scale,this.scale.y=S.scale,this.sizex=125*P.tileAssetScale*S.scale,this.sizey=125*P.tileAssetScale*S.scale,this.scalez=.28,this.cx=s,this.cy=i,this.cz=a,this.wobbleCount=0,this.angle=35*Math.PI/180,this.rotate3d(this.angle)}function k(){PIXI.Container.call(this),this.angle=0,this.targetAngle=0,this.speedMatchValue=0,this.speedMatchTime=0,this.multiMatchValue=0,this.levelBonusValues=null,this.world=null,this.overrideTileTimer=0,this.overrideTileKey=null,this.tileDescriptions=null,this.puzzleLayout=null,this.levelName="",this.tiles=null,this.tilesDataInfo=[],this.managers=null,this.tornadoRemove=!1,this.lastTornadoPiece=0,this.cacheSpriteList=[],this.second=!1,this.removeTiles=null,this.blankCubes=null,this.blankTimeCubes=null,this.lastTimeString="",k.turnSpeed=4*Math.PI/180}function A(){this.preloader=null,this.titles=null,this.game=null,this.bm=null}function P(){P.VERSION="1.5.9",P.testKeys=!1,P.debug=!1,P.showFPS=!1,P.config=null,P.analyticsHelper=null,P.useFocus=!1,P.pauseOnFocusLoss=!1,P.playAgainCount=0,P.playMidRollAd=!1,P.playMidRollAdAfterPause=!1,P.eventChangeAdOnMatch=!1,P.eventChangeAdOnTitlesShow=!1,P.eventChangeAdOnTitlesClose=!1,P.eventChangeAdOnRotate=!1,P.eventChangeAdOnPopup=!0,P.eventChangeAdOnOptions=!0,P.eventChangeAdOnIdle=2e4,P.idleTimer=Number.MAX_VALUE,P.timerStart=120999,P.gameWide=1200,P.gameHigh=900,P.volumeControl=.5,P.click=null,P.hover=null,P.mouseDown=null,P.mouseUp=null,P.swipe=0,P.swipeEnabled=!1,P.quitConfirmed=!1,P.showHelp=!0,P.isFirstTimeInGame=!0,P.forceResize=!1,P.resized=!1,P.resizeConsumed=!1,P.time=0,P.elapsedTime=0,P.muteUntil=-1,P.isPortrait=!0,P.aspectRatio=1,P.countryCode="en-US",P.nowTime=0,P.repeatedGamesLeft=0,P.lowResolutionAssets=void 0,P.tileAssetScale=1,P.suppressBigAnimations=!1,P.pieceScale=.85,P.puzzleOffsetY=0,P._lastTime=0,this.gameControl=null}function M(){this.bg=null,this.sprites=null,this.buttons=null,this.fader=null,this.textures=null}function I(){this.world=null,this.managers=null,this.level=0,this.numLevels=0,this.help=null,this.confirm=null,this.bm=null,this.lastState=-1,this.state=I.STARTING,this.nextState=-1,this.delay=0,this.won=!1,I.paused=!1,I.requestQuit=!1,I.effects=null,I.timeLeft=0,I.score=0,I.options=null}function E(e){this.game=e,this.managers=null,this.lastMatchTime=-1,this.bg=null,this.buttons=null,this.icons=null,this.sprites=null,this.texts=null,this.timeText=null,this.scoreText=null,this.bm=null,this.container1=null,this.container2=null,this.ignoreClick=null,this.puzzleInput=null,this.puzzle=null}e.resetInput=function(){e._mouseDownWhen=0,e._mouseSwipeStart=null},e.pixiListeners=function(t){t.plugins.interaction.on("mousedown",e.mouseDownHandler),t.plugins.interaction.on("mouseup",e.mouseUpHandler),t.plugins.interaction.on("mousemove",e.mouseMoveHandler),t.plugins.interaction.on("mouseout",e.mouseOutHandler),t.plugins.interaction.on("touchstart",e.mouseDownHandler),t.plugins.interaction.on("touchmove",e.mouseMoveHandler),t.plugins.interaction.on("touchclick",e.inputClickHandler),t.plugins.interaction.on("touchend",e.mouseUpHandler)},e.mouseToStage=function(e,t){return{x:e,y:t}},e.inputClickHandler=function(t){P.click=e.mouseToStage(t.data.global.x,t.data.global.y)},e.inputSwipeHandler=function(e){Math.abs(e.deltaX)>Math.abs(e.deltaY)&&(P.swipe=e.deltaX<-20?-1:e.deltaX>20?1:0)},e.mouseOutHandler=function(){P.mouseOut=!0},e.mouseMoveHandler=function(t){P.mouseOut&&(P.mouseOut=!1),P.hover=e.mouseToStage(t.data.global.x,t.data.global.y),e._mouseSwipeStart&&P.swipeEnabled&&L.distanceBetween(e._mouseSwipeStart,P.hover)>=e.swipeDistance&&P.nowTime-e._mouseDownWhen<e.swipeMaxtime&&(e.inputSwipeHandler({deltaX:P.hover.x-e._mouseSwipeStart.x,deltaY:P.hover.y-e._mouseSwipeStart.y}),e._mouseDownWhen=0,P.mouseDown=null)},e.mouseDownHandler=function(t){e._showDebugWindowData&&e._showDebugWindowData<P.nowTime&&(e._debugText.destroy(),e._debugText=null,e._showDebugWindowData=0),e._mouseDownWhen=P.nowTime,P.mouseDown=e.mouseToStage(t.data.global.x,t.data.global.y),!e._mouseSwipeStart&&P.swipeEnabled&&(e._mouseSwipeStart=e.mouseToStage(t.data.global.x,t.data.global.y)),e.triggerCallback("mousedown",P.mouseDown.x,P.mouseDown.y)},e.mouseUpHandler=function(t){var s=0;P.mouseUp&&P.mouseDown&&(s=L.distanceBetween(P.mouseUp,P.mouseDown)),P.mouseDown&&(!P.swipeEnabled||s<e.swipeDistance&&(!e._mouseDownWhen||P.nowTime-e._mouseDownWhen<e.clickTime)?e.inputClickHandler(t):(P.mouseUp=e.mouseToStage(t.data.global.x,t.data.global.y),P.mouseUp&&P.mouseDown&&s>=e.swipeDistance&&e.inputSwipeHandler({deltaX:P.mouseUp.x-P.mouseDown.x,deltaY:P.mouseUp.y-P.mouseDown.y}))),e._mouseDownWhen=0,P.mouseDown=e._mouseSwipeStart=null},e.resizeCanvas=function(){null===P.HTMLElement?e._internalResize(window.innerWidth,window.innerHeight):e._internalResize(P.HTMLElement.clientWidth,P.HTMLElement.clientHeight)},e._internalResize=function(e,t){if(P.forceResize||P.width!=e||P.height!=t){if(P.width=e,P.height=t,P.aspectRatio=P.width/P.height,P.isPortrait=P.aspectRatio<1,void 0===P.lowResolutionAssets){var s=Math.max(P.width*P.app.renderer.resolution,P.height*P.app.renderer.resolution),i=s>635;P.lowResolutionAssets=!i}P.tileAssetScale=P.lowResolutionAssets?.5:1;var n=1;P.renderer.resize(P.width,P.height),P.stage.x=Math.round(P.width/2),P.stage.y=Math.round(P.height/2);var a=P.width/P.gameWide,r=P.height/P.gameHigh;P.background.scale.set(n*Math.max(a,r));var o=S.pieceSizePixels*P.tileAssetScale*S.scale*k.maxHalfTilesWide*.5,l=S.pieceSizePixels*P.tileAssetScale*S.scale*k.maxTilesHigh,h=P.width/o,u=P.height/l;P.puzzle.scale.set(n*Math.min(P.pieceScale*h,P.pieceScale*u)),P.topUI.y=-P.height/2,P.topUI.scale.set(n*Math.min(a,r)),P.fullUI.scale.set(n*Math.min(a*P.fullUIScale,r*P.fullUIScale)),P.rightUI.scale.set(n*Math.min(a,r)),P.rightUI.x=.45*P.width,P.rightUI.y=-P.height/2,P.bottomUI.scale.set(1.5*n*Math.min(a,r)),P.resized=!0,P.resizeConsumed=!1,P.forceResize=!1,console.log("\nMahjonggDarkDimensions "+P.width.toString()+" x "+P.height.toString()+" res = "+(P.lowResolutionAssets?"low":"high")),P.debug&&(console.log("aspectRatio:",P.aspectRatio,P.aspectRatio>=1?"landscape":"portrait"),console.log("devicePixelRatio",window.devicePixelRatio),console.log("doc window.inner:   ",window.innerWidth,"x",window.innerHeight),console.log("Resolution: ",P.lowResolutionAssets?"low":"high"),console.log("View ratio: ",a,":",r),console.log("stage offset: ",P.stage.x,",",P.stage.y,"\n"))}},e.registerCallback=function(t,s,i){P.debug&&console.log("registerCallback for",t),e.callbackList||(e.callbackList=[]),e.callbackList.push({event:t,callback:s,arg:i})},e.triggerCallback=function(t,s,i){if(e.callbackList)for(var n=e.callbackList.length-1;n>=0;--n){var a=e.callbackList[n];a.event==t&&(P.debug&&console.log("triggerCallback for",t),a.callback.call(a.arg.context,s,i,a.arg.args))}},e.clearCallback=function(t,s){if(e.callbackList){for(var i=e.callbackList.length-1;i>=0;--i){var n=e.callbackList[i];if(n.event==t&&n.callback==s){e.callbackList.splice(i,1),P.debug&&console.log("clearCallback for",t);break}}0===e.callbackList.length&&(e.callbackList=null)}},e.clearCallbacks=function(){e.callbackList=null},e.debugWindowData=function(){if(!e._showDebugWindowData){var t=P.width/P.gameWide,s=P.height/P.gameHigh,i="aspectRatio: "+P.aspectRatio+" "+(P.aspectRatio>=1?"landscape":"portrait")+"\n";i+="devicePixelRatio: "+window.devicePixelRatio+"\n",i+="window.inner: "+window.innerWidth+" x "+window.innerHeight+"\n",i+="resolution: "+(P.lowResolutionAssets?"low":"high")+"\n",i+="view ratio: "+t+" : "+s;var n=new a(i,P.textStyleMediumTiny);n.create(P.topUI,-0.45,.25,!0),n.anchor.y=1,e._debugText=n,e._showDebugWindowData=P.nowTime+5e3}};var C={};C.isPressed=null,C.edgeDown=null,C.edgeUp=null,C.debug=!1,C.create=function(e){C.captureKeys=[],P.testKeys&&(C.captureKeys=[z.key_o,z.key_r,z.key_t,z.key_v,z.key_x]),C.debug=e||!1,C.reset(),document.body&&document.body.addEventListener?document.body.addEventListener("keydown",C.keyDown,!0):document.addEventListener?document.addEventListener("keydown",C.keyDown,!0):window.addEventListener?window.addEventListener("keydown",C.keyDown,!0):document.attachEvent&&document.attachEvent("onkeydown",C.keyDown),document.body&&document.body.addEventListener?document.body.addEventListener("keyup",C.keyUp,!0):document.addEventListener?document.addEventListener("keyup",C.keyUp,!0):window.addEventListener?window.addEventListener("keyup",C.keyUp,!0):document.attachEvent&&document.attachEvent("onkeyup",C.keyUp)},C.destroy=function(){C.isPressed=null,C.edgeDown=null,C.edgeUp=null},C.update=function(){return!0},C.reset=function(e){void 0===e?(C.isPressed=[],C.edgeDown=[],C.edgeUp=[]):(C.isPressed[e]=!1,C.edgeDown[e]=!1,C.edgeUp[e]=!1)},C.getCode=function(e){return void 0!==e.keyCode?e.keyCode:void 0!==e.charCode?e.charCode:void 0!==e.which?e.which:void 0!==e.key?e.key:void(P.debug&&console.log("ERROR: Keys.getCode unable to recognise what the key value is called in this object: ",e))},C.keyDown=function(e){var t=C.getCode(e);~C.captureKeys.indexOf(t)&&e.preventDefault(),C.isPressed[t]||(C.edgeDown[t]=!0),C.isPressed[t]=!0},C.keyUp=function(e){var t=C.getCode(e);~C.captureKeys.indexOf(t)&&e.preventDefault(),C.isPressed[t]&&(C.edgeUp[t]=!0),C.isPressed[t]=!1};var z={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,caps_lock:20,escape:27,space_bar:32,page_up:33,page_down:34,end:35,home:36,left_arrow:37,up_arrow:38,right_arrow:39,down_arrow:40,insert_key:45,delete_key:46,key_0:48,key_1:49,key_2:50,key_3:51,key_4:52,key_5:53,key_6:54,key_7:55,key_8:56,key_9:57,key_a:65,key_b:66,key_c:67,key_d:68,key_e:69,key_f:70,key_g:71,key_h:72,key_i:73,key_j:74,key_k:75,key_l:76,key_m:77,key_n:78,key_o:79,key_p:80,key_q:81,key_r:82,key_s:83,key_t:84,key_u:85,key_v:86,key_w:87,key_x:88,key_y:89,key_z:90,left_window_key:91,right_window_key:92,select_key:93,numpad_0:96,numpad_1:97,numpad_2:98,numpad_3:99,numpad_4:100,numpad_5:101,numpad_6:102,numpad_7:103,numpad_8:104,numpad_9:105,multiply:106,add:107,subtract:109,decimal_point:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,num_lock:144,scroll_lock:145,semi_colon:186,equal_sign:187,comma:188,dash:189,period:190,forward_slash:191,grave_accent:192,open_bracket:219,back_slash:220,close_braket:221,single_quote:222},L={};L.normaliseAngle=function(e,t){t||(t=2*Math.PI);for(var s=t/2;-s>e;)e+=t;for(;e>=s;)e-=t;return e},L.normaliseAnglePositive=function(e,t){for(t||(t=2*Math.PI);0>e;)e+=t;for(;e>=t;)e-=t;return e},L.distance=function(e,t,s,i){var n=s-e,a=i-t;return Math.sqrt(n*n+a*a)},L.distanceBetween=function(e,t){var s=t.x-e.x,i=t.y-e.y;return Math.sqrt(s*s+i*i)},L.rotateTo=function(e,t,s,i){i||(i=2*Math.PI);var n,a=i/2,r=L.normaliseAnglePositive(e-t+i,i);return n=r>a?e+Math.min(i-r,s):0!==r?e-Math.min(r,s):t,L.normaliseAngle(n,i)},L.replaceAt=function(e,t,s){return e.substr(0,t)+s+e.substr(t+s.length)},L.setValuesFromObject=function(e,t){if(t)for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])},L.indexOfParameter=function(e,t,s){if(!e)return-1;for(var i=0,n=e.length;n>i;i++)if(e[i][t]==s)return i;return-1},L.indexOfStringNoCase=function(e,t){if(!e)return-1;for(var s=0,i=e.length;i>s;s++)if(e[s].toLowerCase()==t.toLowerCase())return s;return-1},L.timeToString=function(e){(void 0===e||null===e||isNaN(e))&&(e=0);var t=e/1e3,s=t/60,i=Math.floor(s).toString(),n=(Math.floor(t)%60).toString();return n.length<2&&(n="0"+n),i+":"+n},L.clamp=function(e,t,s){return Math.min(Math.max(e,t),s)},L.padToLength=function(e,t,s,i){for(;e.length<t;)i?e+=s:e=s+e;return e},L.randomFromList=function(e){var t=Math.floor(Math.random()*e.length);return e[t]},L.makeFunctionForSprite=function(e){return function(t){L.setValuesFromObject(e,t)}},L.focusChangeCallback=null,L.focusChangeContext=null,L._visListener=!1,L._hidden=!1,L._focusIn=function(){L._hidden=!1,P.debug&&console.log("Utils._focusIn hidden =",L._hidden),L.focusChangeContext&&L.focusChangeCallback&&L.focusChangeCallback.call(L.focusChangeContext,L._hidden)},L._focusOut=function(){L._hidden=!0,P.debug&&console.log("Utils._focusOut hidden =",L._hidden),L.focusChangeContext&&L.focusChangeCallback&&L.focusChangeCallback.call(L.focusChangeContext,L._hidden)},L.detectHidden=function(){if(!L._visListener){var e=t(),n=s(e),a=i(e);document.addEventListener(a,function(){document[n]?L._focusOut():L._focusIn()}),window.addEventListener("focus",L._focusIn,!1),window.addEventListener("blur",L._focusOut,!1),L._visListener=!0}},L.isHidden=function(){return document.hidden},L.blanker=null,L.addBlanker=function(e){return null!==L.blanker?void L.blanker.instances++:(L.blanker=new n,L.blanker.create(P.fullUI,"menuAtlas","blanker",e,0,0),L.blanker.anchor.set(.5),L.blanker.scale.set(40),void(L.blanker.instances=1))},L.removeBlanker=function(){L.blanker&&(L.blanker.instances--,L.blanker.instances<=0&&(L.blanker.destroy(),L.blanker=null))},n.prototype=Object.create(PIXI.Sprite.prototype),n.prototype.constructor=n,n.prototype.create=function(e,t,s,i,n,a,r){P.debug&&console.log("Sprite.create",s),this.atlas=t,this.key=s,this.textures=i,this.myFilters=null,this.destroyTexture=!1,this.key&&(this.texture=this.textures.get(t,s),!this.texture&&P.debug&&console.log("WARNING: unrecognised texture applied to Sprite "+s)),e.addChild(this),r?(this.pcntx=n||0,this.pcnty=a||0):(this.x=n||0,this.y=a||0),this.bounds=this.getBounds(!1),this.getGlobalScale()},n.prototype.destroy=function(){P.debug&&console.log("Sprite.destroy",this.key),this.fader&&(this.fader.destroy(),this.fader=null),this.myFilters=null,this.tweener=null,this.pickerMaskData=null,this.responsive=null,this.globalScale=null,this.texture&&this.destroyTexture&&this.texture.destroy({texture:!0,baseTexture:!0}),this.texture=null,this.textures=null,PIXI.Sprite.prototype.destroy.call(this)},n.prototype.update=function(e){return this._texture&&!this._texture.orig&&console.log("_texture has no orig! "+this.key),P.resized&&(this.getGlobalScale(!0),this.responsive&&this.handleResponsiveLayout(),isNaN(this.percentx)||(this.pcntx=this.percentx),isNaN(this.percenty)||(this.pcnty=this.percenty),P.resizeConsumed=!0),this.fader&&(this.alpha=this.fader.fadeValue,this.fader.fading(e)),!0},n.prototype.addFilter=function(e){this.myFilters||(this.myFilters=[]),-1===this.myFilters.indexOf(e)&&(this.myFilters.push(e),this.filters=this.myFilters)},n.prototype.removeFilter=function(e){if(!this.myFilters)return void(this.filters=null);var t=this.myFilters.indexOf(e);-1!==t&&(this.myFilters.splice(t,1),this.filters=this.myFilters)},n.prototype.setPickerData=function(e){this.pickerMaskData=e},n.prototype.setFrame=function(e,t){return(t||this.key!=e)&&(this.key=e,this.key)?(this.texture=this.textures.get(this.atlas,e),!0):!1},n.prototype.getGlobalScale=function(e){if(e||null===this.globalScale){for(var t=this.scale.x,s=this.scale.y,i=this.parent;i;)t*=i.scale.x,s*=i.scale.y,i=i.parent;this.globalScale={x:t,y:s}}return this.globalScale},n.prototype.pixelPicker=function(e,t){if(this.bounds=this.getBounds(!1),e<this.bounds.left||e>=this.bounds.right)return 0;if(t<this.bounds.top||t>=this.bounds.bottom)return 0;this.getGlobalScale();var s=4*Math.floor((e-this.bounds.left)/this.globalScale.x)+3,i=Math.floor((t-this.bounds.top)/this.globalScale.y),n=this.pickerMaskData[s+i*this.texture.frame.width*4];return n?!0:!1},n.prototype.createCanvasFromTexture=function(){var e=document.createElement("canvas");e.width=this.texture.frame.width,e.height=this.texture.frame.height;var t=e.getContext("2d");return t.drawImage(this.texture.baseTexture.source,this.texture.frame.x,this.texture.frame.y,this.texture.frame.width,this.texture.frame.height,0,0,this.texture.frame.width,this.texture.frame.height),e},n.prototype.setCallback=function(e,t,s){this.fadeCallback=e,this.fadeCtx=t,this.fadeArg=s},n.prototype.addFader=function(e,t,s,i,n,a){this.fader=new y,this.fader.setFade(e,t,s,i,n,a)},n.prototype.getPixels=function(){var e=PIXI.RenderTexture.create(this.texture._frame.width,this.texture._frame.height);return P.renderer.render(this,e),P.renderer.extract.pixels(e)},n.prototype.handleResponsiveLayout=function(){for(var e=!1,t=0;t<this.responsive.length;t++){var s=this.responsive[t];isNaN(s.minWidth*this.scale.x)||(P.width<s.minWidth?e=this.respond(s):e||this.respondDefault()),void 0!==s.aspectRatioMin&&(P.aspectRatio<s.aspectRatioMin?e=this.respond(s):e||this.respondDefault())}},n.prototype.respond=function(e){var t=!1;return e.position&&(this.pcntx=e.position.x,this.pcnty=e.position.y,t=!0),e.scale&&(this.scale.x=e.scale.x,this.scale.y=e.scale.y,t=!0),t},n.prototype.respondDefault=function(){this.pcntx=this.responsive.x,this.pcnty=this.responsive.y,this.scale.x=this.responsive.scale.x,this.scale.y=this.responsive.scale.y},Object.defineProperties(n.prototype,{scaleFactor:{get:function(){return this.scale},set:function(e){"number"==typeof e?(this.scale.x=e,this.scale.y=e):(e.hasOwnProperty("x")&&(this.scale.x=e.x),e.hasOwnProperty("y")&&(this.scale.y=e.y))}},pcntx:{set:function(e){this.percentx=e,this.parent&&this.parent.texture.noFrame?(this.msx=P.width/this.parent.scale.x,this.x=e*this.msx):this.x=this.parent&&this.parent.parent&&!this.parent.parent.parent?e*P.width:e*this.parent.width}},pcnty:{set:function(e){this.percenty=e,this.parent&&this.parent.texture.noFrame?(this.msy=P.height/this.parent.scale.y,this.y=e*this.msy):this.y=this.parent&&this.parent.parent&&!this.parent.parent.parent?e*P.height:e*this.parent.height}},setx:{set:function(e){this.x=e,this.parent&&this.parent.texture.noFrame?(this.msx=P.width/this.parent.scale.x,this.percentx=e/this.msx):this.percentx=this.parent&&this.parent.parent&&!this.parent.parent.parent?e/P.width:e/this.parent.width}},responsiveLayout:{set:function(e){this.responsive=e,this.responsive.x=this.percentx,this.responsive.y=this.percenty,this.responsive.scale={x:this.scale.x,y:this.scale.y}}}}),a.prototype=Object.create(PIXI.Text.prototype),a.prototype.constructor=a,a.prototype.create=function(e,t,s,i){e.addChild(this),i?(this.pcntx=t||0,this.pcnty=s||0):(this.x=t||0,this.y=s||0)},a.prototype.destroy=function(){this.responsive=null,PIXI.Text.prototype.destroy.call(this)},a.prototype.update=function(){return P.resized&&(this.responsive&&this.handleResponsiveLayout(),isNaN(this.percentx)||(this.pcntx=this.percentx),isNaN(this.percenty)||(this.pcnty=this.percenty),P.resizeConsumed=!0),!0},a.prototype.handleResponsiveLayout=function(){for(var e=!1,t=0;t<this.responsive.length;t++){var s=this.responsive[t];isNaN(s.minWidth*this.scale.x)||(P.width<s.minWidth?e=this.respond(s):e||this.respondDefault()),void 0!==s.aspectRatioMin&&(P.aspectRatio<s.aspectRatioMin?e=this.respond(s):e||this.respondDefault())}},a.prototype.respond=function(e){var t=!1;return e.position&&(this.pcntx=e.position.x,this.pcnty=e.position.y,t=!0),e.scale&&(this.scale.x=e.scale.x,this.scale.y=e.scale.y,t=!0),t},a.prototype.respondDefault=function(){this.pcntx=this.responsive.x,this.pcnty=this.responsive.y,this.scale.x=this.responsive.scale.x,this.scale.y=this.responsive.scale.y},Object.defineProperties(a.prototype,{scaleFactor:{get:function(){return this.scale},set:function(e){"number"==typeof e?(this.scale.x=e,this.scale.y=e):(e.hasOwnProperty("x")&&(this.scale.x=e.x),e.hasOwnProperty("y")&&(this.scale.y=e.y))}},pcntx:{set:function(e){this.percentx=e,this.parent&&this.parent.texture.noFrame?(this.msx=P.width/this.parent.scale.x,this.x=e*this.msx):this.x=this.parent==P.window?e*P.width:e*this.parent.width}},pcnty:{set:function(e){this.percenty=e,this.parent&&this.parent.texture.noFrame?(this.msy=P.height/this.parent.scale.y,this.y=e*this.msy):this.y=this.parent==P.window?e*P.height:e*this.parent.height}},responsiveLayout:{set:function(e){this.responsive=e,this.responsive.x=this.percentx,this.responsive.y=this.percenty,this.responsive.scale={x:this.scale.x,y:this.scale.y}}}}),r.prototype.create=function(e,t,s,i,o){this.parent=e,this.managers=t,this.callback=i||null,this.context=o||null,this.timeOut=0,this.doneIn=this.doneOut=!1,this.removing=!1,this.removeAfterClick=!0,this.adShown=!1,this.buttons=[],this.buttonPressed=0,L.addBlanker(this.managers.textures),this.bg=new n,this.bg.create(this.parent,"menuAtlas","popup",this.managers.textures),this.bg.anchor.set(.5,.5);var l=P.textStyleBoldHugeCentered.clone();l.wordWrapWidth=800;var h=this.managers.locale.get(s)||s;this.text=new a(h,l),this.text.create(this.bg,0,0,!0),this.text.anchor.set(.5,.45),r.tweenIn.step=L.makeFunctionForSprite(this.bg),this.bg.tweener=new Tweenable,this.bg.tweener.tween(r.tweenIn),this.bg.tweener.owner=this.bg,this.bg.tweener.context=this,this.managers.audio.play("snd_rotate")},r.prototype.addButton=function(e,t){var s=new h(h.TYPE_BUTTON);s.create(this.bg,"introAtlas","play-button",this.managers,0,340,!1,"play-button","play-button-rollover","play-button-down",t||"click1_event"),s.anchor.set(.5,.5);var i=new a(this.managers.locale.get(e),P.textStyleBoldButtonsLarge);i.create(s,0,0,!0),i.anchor.set(.5,.5),s.text=i,s.sfx="snd_clickPlay",this.buttons.push(s)},r.prototype.addButtons=function(e,t,s){this.removeAfterClick=s;var i=new h(h.TYPE_BUTTON);i.create(this.bg,"introAtlas","play-button",this.managers,-200,340,!1,"play-button","play-button-rollover","play-button-down","click1_event"),i.anchor.set(.5,.5);var n=new a(this.managers.locale.get(e),P.textStyleBoldButtonsLarge);n.create(i,0,0,!0),n.anchor.set(.5,.5),i.text=n,i.sfx="snd_clickPlay",this.buttons.push(i),i=new h(h.TYPE_BUTTON),i.create(this.bg,"introAtlas","play-button",this.managers,200,340,!1,"play-button","play-button-rollover","play-button-down","click2_event"),i.anchor.set(.5,.5),n=new a(this.managers.locale.get(t),P.textStyleBoldButtonsLarge),n.create(i,0,0,!0),n.anchor.set(.5,.5),i.text=n,i.sfx="snd_clickPlay",this.buttons.push(i)},r.prototype.remove=function(e,t){return this.removing?!1:(this.bg&&this.bg.tweener&&(this.bg.tweener.stop(),this.bg.tweener.owner=null,this.bg.tweener.context=null),this.removing=!0,this.bg&&(r.tweenOut.step=L.makeFunctionForSprite(this.bg),this.bg.tweener.tween(r.tweenOut),this.bg.tweener.owner=this,this.bg.tweener.context=this),this.removeContext=e||null,this.removeArgument=t||null,!0)},r.prototype.destroy=function(){var e,t;if(L.removeBlanker(),this.buttons)for(e=0,t=this.buttons.length;t>e;e++)this.buttons[e].destroy();this.buttons=null,this.bg&&this.bg.tweener&&(this.bg.tweener.stop(),this.bg.tweener.owner=null,this.bg.tweener.context=null),this.bg&&this.bg.destroy(),this.bg=null,this.text&&this.text.destroy(),this.text=null,this.managers=null,this.parent=null,this.callback=null,this.context=null,this.removeContext=null,this.removeArgument=null,this.removing=!1,P.idleTimer=P.eventChangeAdOnIdle},r.prototype.update=function(e){if(this.doneIn&&(P.eventChangeAdOnPopup&&!this.adShown&&(P.arenaHelper.sendEventChange(),this.adShown=!0,this.timeOut<2e3&&(this.timeOut=2e3)),this.context&&this.callback&&(this.callback.call(this.context),this.callback=null),this.timeOut&&(this.timeOut-=P.elapsedTime,this.timeOut<=0&&(this.timeOut=0,this.remove(this.context,e))),this.buttons)){var t,s,i;for(t=0,s=this.buttons.length;s>t&&(i=this.buttons[t].update(),1!=this.buttons[t].alpha&&(i=null),!i);t++);if("click1_event"==i){if(this.timeOut=0,this.buttonPressed=1,!this.removeAfterClick)return!1;this.remove(this.context,e)}else if("click2_event"==i){if(this.timeOut=0,this.buttonPressed=2,!this.removeAfterClick)return!1;this.remove(this.context,e)}}return!this.doneOut},r.prototype.fadeButtons=function(e){for(var t=0,s=this.buttons.length;s>t;t++)this.buttons[t].addFader(e||-.02,1)};var O=350;r.tweenIn={from:{pcnty:1},to:{pcnty:0},duration:O,easing:"easeInQuad",step:null,finish:function(){this.context.doneIn=!0}},r.tweenOut={from:{pcnty:0},to:{pcnty:-1},duration:O,easing:"easeFrom",step:null,finish:function(){this.context.doneOut=!0,this.owner&&(this.owner.removeContext&&this.owner.removeArgument&&(this.owner.removeContext[this.owner.removeArgument]=null),this.owner.destroy(),this.owner=null)}},o.prototype.create=function(e,t,s,i,r,o){P.swipeEnabled=!1,this.game=e,this.managers=t,this.context=i,this.onYes=r,this.onNo=o,this.sprites=[],this.buttons=[],this.texts=[],this.bg=new n,this.bg.create(P.background,"introAtlas","title_bg",t.textures),this.bg.anchor.set(.5,1),this.bg.y=P.height/2/this.bg.parent.scale.y,this.panel=new n,this.panel.create(P.fullUI,"menuAtlas","backboard",this.managers.textures,0,0,!0),this.panel.anchor.set(.5),this.sprites.push(this.panel);var l=new h(h.TYPE_BUTTON);l.create(this.panel,"introAtlas","play-button",this.managers,-.2,.14,!0,"play-button","play-button-rollover","play-button-down","click_yes_event"),l.anchor.set(.5,.5),l.scale.set(1);var u=new a(this.managers.locale.get("quit_yes_button_string"),P.textStyleBoldButtons);u.create(l,0,0,!0),u.anchor.set(.5,.5),l.text=u,l.sfx="snd_clickPlay",l.sfxHover="snd_rollOver",this.buttons.push(l),l=new h(h.TYPE_BUTTON),l.create(this.panel,"introAtlas","play-button",this.managers,.2,.14,!0,"play-button","play-button-rollover","play-button-down","click_no_event"),l.anchor.set(.5,.5),l.scale.set(1),u=new a(this.managers.locale.get("quit_no_button_string"),P.textStyleBoldButtons),u.create(l,0,0,!0),u.anchor.set(.5,.5),l.text=u,l.sfx="snd_clickPlay",l.sfxHover="snd_rollOver",this.buttons.push(l);var c=P.textStyleBold.clone();c.wordWrap=!0,c.wordWrapWidth=800,u=new a(this.managers.locale.get(s),c),u.create(this.panel,0,-.1,!0),u.anchor.set(.5,.5),this.texts.push(u)},o.prototype.destroy=function(){var e;if(this.bg&&(this.bg.destroy(),this.bg=null),this.panel&&(this.panel.destroy({children:!0}),this.panel=null),this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}this.managers=null,this.context=null,this.onYes=null,this.onNo=null,P.resized=!0,P.resizeConsumed=!1,P.swipeEnabled=!0},o.prototype.update=function(){var e,t;if(this.bg.y=P.height/2/this.bg.parent.scale.y,this.bg.update(),this.panel.update(),this.sprites)for(e=0;e<this.sprites.length;e++){var s=this.sprites[e];s.update()}if(this.buttons)for(e=0;e<this.buttons.length;e++){var i=this.buttons[e];if(t=i.update(),null!==t)break}return"click_yes_event"==t?(P.click=null,this.onYes.call(this.context),!1):"click_no_event"==t?(P.click=null,this.onNo.call(this.context),!1):!0},l.prototype.create=function(e,t){this.managers=e,this.sprites=[],this.buttons=[],this.texts=[],L.addBlanker(this.managers.textures),this.panel=new n,this.panel.create(P.fullUI,"menuAtlas","backboard",this.managers.textures,0,0,!0),this.panel.anchor.set(.5),this.sprites.push(this.panel);var s=new h(h.TYPE_BUTTON);s.create(this.panel,"introAtlas","play-button",this.managers,0,361,!1,"play-button","play-button-rollover","play-button-down","click_event"),s.anchor.set(.5,.5),this.buttons.push(s);var i;i=t?new a(this.managers.locale.get("help_play_string"),P.textStyleBoldButtonsLarge):new a(this.managers.locale.get("continue_button_string"),P.textStyleBoldButtonsLarge),i.create(s,0,0,!0),i.anchor.set(.5,.5),s.text=i,s.sfx="snd_clickPlay",s.sfxHover="snd_rollOver",s=new h(h.TYPE_TOGGLE),s.create(this.panel,"menuAtlas","basic-gameplay-on",this.managers,-.432,-.4322,!0,"basic-gameplay-on","basic-gameplay-on","basic-gameplay-on","click_tab1_event",null,"basic-gameplay-off","basic-gameplay-off-rollover","basic-gameplay-off","click_tab1_event"),s.toggled=!0,this.buttons.push(s),this.tab1={button:s},s.sfx="snd_clickPlay",s.sfxHover="snd_rollOver",s=new h(h.TYPE_TOGGLE),s.create(this.panel,"menuAtlas","max-your-score-button-off",this.managers,-.175,-.4322,!0,"max-your-score-button-on","max-your-score-button-on","max-your-score-button-on","click_tab2_event",null,"max-your-score-button-off","max-your-score-button-off-rollover","max-your-score-button-off","click_tab2_event"),s.toggled=!1,this.buttons.push(s),this.tab2={button:s},s.sfx="snd_clickPlay",s.sfxHover="snd_rollOver",i=new a(this.managers.locale.get("help_page1_text_string"),P.textStyleMedium),i.create(this.panel,-.3,-.345,!0),i.anchor.set(.5,.5),this.texts.push(i),i=new a(this.managers.locale.get("help_page2_text_string"),P.textStyleMedium),i.create(this.panel,-0,-.345,!0),i.anchor.set(.5,.5),this.texts.push(i);
var r=new u;r.create(this.panel,"menuAtlas","check-box",this.managers,208,-315,!1,"check-box","check-box-rollover","check-box","check_toggled_event",27,0),r.anchor.set(0,.5),r.sfx="snd_clickPlay",r.sfxHover="snd_rollOver",this.buttons.push(r),this.checkBox=r,r.setCheck(P.showHelp);var o=P.textStyleMediumTiny.clone();o.wordWrap=!0,o.wordWrapWidth=170,i=new a(this.managers.locale.get("help_show_help_string"),o),i.create(this.panel,264,-315,!1),i.anchor.set(0,.5),this.texts.push(i),this.tab1.list=[];var c=P.textStyleMedium2.clone();c.wordWrap=!0,c.wordWrapWidth=600,i=new a(this.managers.locale.get("help_page1_text1_string"),c),i.create(this.panel,-.1,-.24,!0),i.anchor.set(0,0),this.texts.push(i),this.tab1.list.push(i);var d=new n;d.create(this.panel,"menuAtlas","matching_rules",this.managers.textures,-.28,-.15,!0),d.anchor.set(.5,.5),d.scale.set(.6,.6),this.sprites.push(d),this.tab1.list.push(d),d=new n,d.create(this.panel,"gameAtlas","time icon",this.managers.textures,.24,.02,!0),d.anchor.set(.5,.5),d.scale.set(.75,.75),this.sprites.push(d),this.tab1.list.push(d),i=new a("2:55",P.textStyleSemiBold),i.create(this.panel,.28,.02,!0),i.anchor.set(0,.5),this.texts.push(i),this.tab1.list.push(i);var p=c.clone();p.wordWrapWidth=700,i=new a(this.managers.locale.get("help_page1_text2_string"),p),i.create(this.panel,-.4,-.02,!0),i.anchor.set(0,0),this.texts.push(i),this.tab1.list.push(i),d=new n,d.create(this.panel,"gameAtlas","arrow_lft",this.managers.textures,-.34,.2,!0),d.anchor.set(.5,.5),d.scale.set(.4,.4),this.sprites.push(d),this.tab1.list.push(d),d=new n,d.create(this.panel,"gameAtlas","arrow_rgt",this.managers.textures,-.18,.2,!0),d.anchor.set(.5,.5),d.scale.set(.4,.4),this.sprites.push(d),this.tab1.list.push(d),i=new a(this.managers.locale.get("help_page1_text3_string"),c),i.create(this.panel,-.1,.14,!0),i.anchor.set(0,0),this.texts.push(i),this.tab1.list.push(i),this.tab2.list=[],d=new n,d.create(this.panel,"menuAtlas","x2_speedmatch",this.managers.textures,-.305,-.2,!0),d.anchor.set(.5,.5),d.scale.set(.75,.75),this.sprites.push(d),this.tab2.list.push(d),i=new a(this.managers.locale.get("help_page2_text1_string"),p),i.create(this.panel,-.2,-.2-.04,!0),i.anchor.set(0,0),this.texts.push(i),this.tab2.list.push(i),d=new n,d.create(this.panel,"menuAtlas","x5_multimatch",this.managers.textures,-.305,-.015,!0),d.anchor.set(.5,.5),d.scale.set(.75,.75),this.sprites.push(d),this.tab2.list.push(d),i=new a(this.managers.locale.get("help_page2_text2_string"),p),i.create(this.panel,-.2,-0.055,!0),i.anchor.set(0,0),this.texts.push(i),this.tab2.list.push(i),d=new n,d.create(this.panel,"menuAtlas","time-bonus",this.managers.textures,-.305,.17,!0),d.anchor.set(.5,.5),d.scale.set(.75,.75),this.sprites.push(d),this.tab2.list.push(d),i=new a(this.managers.locale.get("help_page2_text6_string"),p),i.create(this.panel,-.2,.13,!0),i.anchor.set(0,0),this.texts.push(i),this.tab2.list.push(i);var g=p.clone();g.wordWrapWidth=900,i=new a(this.managers.locale.get("help_page2_text5_string"),g),i.create(this.panel,0,.25,!0),i.anchor.set(.5,0),this.texts.push(i),this.tab2.list.push(i),this.showTab(1,!1),l.tweenIn.step=L.makeFunctionForSprite(this.panel),this.panel.tweener=new Tweenable,this.panel.tweener.tween(l.tweenIn),this.panel.tweener.owner=this.panel,this.panel.tweener.context=this,this.removing=!1,this.managers.audio.play("snd_rotate")},l.prototype.remove=function(e){this.removing||(this.removing=!0,P.debug&&console.log("Help.remove"),l.tweenOut.step=L.makeFunctionForSprite(this.panel),this.panel.tweener.tween(l.tweenOut),this.panel.tweener.owner=this,this.destroyCallback=e)},l.prototype.destroy=function(){var e;if(L.removeBlanker(),this.destroyCallback&&(this.destroyCallback.call(this),this.destroyCallback=null),this.panel&&(this.panel.tweener=null,this.panel.destroy({children:!0}),this.panel=null),this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}this.tab1=this.tab2=null,this.managers=null,P.resized=!0,P.resizeConsumed=!1},l.prototype.update=function(){var e,t;if(this.removing)return!0;if(this.panel.update(),this.buttons)for(e=0;e<this.buttons.length;e++){var s=this.buttons[e];if(t=s.update(),null!==t)break}if("click_event"==t||C.isPressed[32])return P.resetInput(),!1;if("check_toggled_event"==t&&(P.showHelp=this.checkBox.checked,this.managers.preloader.loadManager.saveGameStatus()),("click_tab1_event"==t&&!this.tab1.button.toggled||"click_tab2_event"==t&&!this.tab2.button.toggled)&&(this.tab2.button.toggled=this.tab1.button.toggled,this.tab1.button.toggled=!this.tab1.button.toggled,this.showTab(this.tab1.button.toggled?1:0,!1),this.showTab(this.tab1.button.toggled?0:1,!0),P.analyticsHelper.analytic)){var i=this.tab1.button.toggled?"Prev":"Next";P.analyticsHelper.analytic.helpPage(i)}return!0},l.prototype.showTab=function(e,t){var s=0===e?this.tab1.list:this.tab2.list;if(s)for(var i=0;i<s.length;i++)s[i].visible=t};var R=350;l.tweenIn={from:{pcnty:1},to:{pcnty:0},duration:R,easing:"easeInQuad",step:null,finish:function(){}},l.tweenOut={from:{pcnty:0},to:{pcnty:-1},duration:R,easing:"easeFrom",step:null,finish:function(){this.context.doneOut=!0,this.owner&&(this.owner.destroy(),this.owner=null)}},h.TYPE_BUTTON=1,h.TYPE_CHECKBOX=2,h.TYPE_TOGGLE=3,h.TYPE_NOLATCH=4,h.prototype=Object.create(n.prototype),h.prototype.constructor=h,h.prototype.create=function(t,s,i,a,r,o,l,h,u,c,d,p,g,m,y,f,v){this.managers=a,n.prototype.create.call(this,t,s,i,this.managers.textures,r,o,l),this.upKey={on:h,off:g},this.overKey={on:u,off:m},this.downKey={on:c,off:y},this.downEvent={on:d,off:f},this.overEvent={on:p,off:v},this.downDetected=!0,this._toggled="on",this.text=null,this.sfx=null,this.sfxHover=null,e.registerCallback("mousedown",this.playSfx,{context:this})},h.prototype.destroy=function(){e.clearCallback("mousedown",this.playSfx),this.managers=null,n.prototype.destroy.call(this),this.text&&(this.text.destroy(),this.text=null),this.upKey=this.overKey=this.downKey=this.downEvent=this.overEvent=null,this._toggled=null,this.sfx=this.sfxHover=null},h.prototype.update=function(){var e=null,t=!1,s=!1;this.calculateBounds();var i=this.getBounds();return s=this.type==h.TYPE_BUTTON||this.type==h.TYPE_NOLATCH?this.downDetected&&null!==P.mouseDown&&i.contains(P.mouseDown.x,P.mouseDown.y)||null!==P.click&&i.contains(P.click.x,P.click.y):null!==P.click&&i.contains(P.click.x,P.click.y),s&&(this.setFrame(this.downKey[this._toggled]),P.mouseDown=P.click=null,e=this.downEvent[this._toggled],t=!0),this.type==h.TYPE_BUTTON&&this.key==this.downKey[this._toggled]&&this.downKey[this._toggled]!=this.upKey[this._toggled]&&(t=!0),!t&&P.hover&&i.contains(P.hover.x,P.hover.y)&&(this.setFrame(this.overKey[this._toggled])&&this.sfxHover&&this.managers.audio.play(this.sfxHover),this.overEvent&&(e=this.overEvent[this._toggled]),t=!0),t||this.type==h.TYPE_TOGGLE||this.setFrame(this.upKey[this._toggled]),n.prototype.update.call(this),this.text&&this.text.update(),e},h.prototype.playSfx=function(e,t){if(this&&this.managers&&this.sfx){this.calculateBounds();var s=this.getBounds();s.contains(e,t)&&this.managers.audio.play(this.sfx)}},Object.defineProperties(h.prototype,{toggled:{set:function(e){this._toggled=e?"on":"off",this.setFrame(this.upKey[this._toggled])},get:function(){return"on"==this._toggled}}}),u.EVENT_CLICK="check_click",u.prototype=Object.create(h.prototype),u.prototype.constructor=u,u.prototype.create=function(e,t,s,i,a,r,o,l,c,d,p,g,m){this.tick=new n,this.tick.create(this,t,"check",i.textures,g,m,!1),this.tick.anchor.set(.5),this.checked=!0,this.toggleEvent=p,h.prototype.create.call(this,e,t,s,i,a,r,o,l,c,d,u.EVENT_CLICK),this.downDetected=!1},u.prototype.destroy=function(){h.prototype.destroy.call(this)},u.prototype.update=function(){var e=h.prototype.update.call(this);return e==u.EVENT_CLICK&&(this.setCheck(!this.checked),this.toggleEvent&&(e=this.toggleEvent)),e},u.prototype.setCheck=function(e){this.checked=e,this.tick.visible=e},c.prototype.create=function(e,t){P.swipeEnabled=!1,this.game=e,this.managers=t,this.sprites=[],this.buttons=[],this.texts=[],this.doneIn=this.doneOut=!1,this.adShown=!1,L.addBlanker(this.managers.textures),this.panel=new n,this.panel.create(P.fullUI,"menuAtlas","backboard",this.managers.textures,0,0,!0),this.panel.anchor.set(.5),this.sprites.push(this.panel);var s=new a(this.managers.locale.get("options_header_string"),P.textStyleBold);s.create(this.panel,0,-.34,!0),s.anchor.set(.5,.5),this.texts.push(s);var i=new h(h.TYPE_BUTTON);i.create(this.panel,"menuAtlas","close",this.managers,.33,-.3,!0,"close","close_rollover","close-down","click_close_event"),i.anchor.set(.5,.5),i.scale.set(2),i.sfx="snd_clickPlay",i.sfxHover="snd_rollOver",this.buttons.push(i);var r=-.15,o=.16;if(!this.isJPay){r=.15,o=.16,i=new h(h.TYPE_BUTTON),i.create(this.panel,"menuAtlas","sound",this.managers,-.22,r-.35+0*o,!0,"sound","sound_rollover","sound-down","click_sound_event",null,"sound-no","sound-no_rollover","sound-no-down","click_sound_event_mute",null),i.anchor.set(0,.5),i.toggled=!this.managers.audio.mute,i.sfx="snd_clickPlay",i.sfxHover="snd_rollOver",this.buttons.push(i),this.soundBtn=i;var l=new n;l.create(this.panel,"menuAtlas","slider-bar",this.managers.textures,-.1,r-.35+0*o,!0),l.anchor.set(0,.5),this.sprites.push(l),this.sliderBar[0]=l,l=new n,l.create(this.sliderBar[0],"menuAtlas","slider",this.managers.textures,0,0,!0),l.anchor.set(.5,.5),this.sprites.push(l),l.setx=this.sliderBar[0].width*w.sfxVolume,this.sliderTab[0]=l,i=new h(h.TYPE_BUTTON),i.create(this.panel,"menuAtlas","music",this.managers,-.22,r-.35+1*o,!0,"music","music_rollover","music-down","click_music_event",null,"music-no","music-no_rollover","music-no-down","click_music_event_mute"),i.anchor.set(0,.5),i.toggled=!this.managers.audio.tunesMuted,i.sfx="snd_clickPlay",i.sfxHover="snd_rollOver",this.buttons.push(i),this.musicBtn=i,l=new n,l.create(this.panel,"menuAtlas","slider-bar",this.managers.textures,-.1,r-.35+1*o,!0),l.anchor.set(0,.5),this.sprites.push(l),this.sliderBar[1]=l,l=new n,l.create(this.sliderBar[1],"menuAtlas","slider",this.managers.textures,0,0,!0),l.anchor.set(.5,.5),l.setx=this.sliderBar[1].width*w.musicVolume,this.sprites.push(l),this.sliderTab[1]=l}i=new h(h.TYPE_NOLATCH),i.create(this.panel,"menuAtlas","help",this.managers,-.22,r-.35+2*o,!0,"help","help_rollover","help-down","click_help_event"),i.anchor.set(0,.5),i.sfx="snd_clickPlay",i.sfxHover="snd_rollOver",this.buttons.push(i),s=new a(this.managers.locale.get("help_header_string"),P.textStyleLarge),s.create(this.panel,-.1,r-.35+2*o,!0),s.anchor.set(0,.5),this.texts.push(s),i=new h(h.TYPE_NOLATCH),i.create(this.panel,"menuAtlas","quit",this.managers,-.22,r-.35+3*o,!0,"quit","quit_rollover","quit-down","click_quit_event"),i.anchor.set(0,.5),i.sfx="snd_clickPlay",i.sfxHover="snd_rollOver",this.buttons.push(i),s=new a(this.managers.locale.get("options_quit_string"),P.textStyleLarge),s.create(this.panel,-.1,r-.35+3*o,!0),s.anchor.set(0,.5),this.texts.push(s);var u=null;u=new a("v"+P.VERSION,P.textStyleVersionTiny),u.anchor.y=1,u.create(this.panel,.325,.38,!0),c.tweenIn.step=L.makeFunctionForSprite(this.panel),this.panel.tweener=new Tweenable,this.panel.tweener.tween(c.tweenIn),this.panel.tweener.owner=this.panel,this.panel.tweener.context=this,this.removing=!1,this.managers.audio.play("snd_rotate")},c.prototype.remove=function(e){this.removing||(this.removing=!0,P.debug&&console.log("Options.remove"),c.tweenOut.step=L.makeFunctionForSprite(this.panel),this.panel.tweener.tween(c.tweenOut),this.panel.tweener.owner=this,this.destroyCallback=e)},c.prototype.destroy=function(){var e;if(L.removeBlanker(),this.destroyCallback&&(this.destroyCallback.call(this),this.destroyCallback=null),this.panel&&(this.panel.tweener=null,this.panel.destroy({children:!0}),this.panel=null),this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}if(this.buttons){for(e=0;e<this.buttons.length;e++)this.buttons[e].destroy();this.buttons=null}if(this.soundBtn=null,this.musicBtn=null,this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}this.sliderTab=null,this.sliderBar=null,this.game=null,this.managers=null,P.resized=!0,P.resizeConsumed=!1,P.swipeEnabled=!0,P.idleTimer=P.eventChangeAdOnIdle},c.prototype.update=function(){var e,t;if(this.doneIn&&P.eventChangeAdOnOptions&&!this.adShown&&(P.arenaHelper.sendEventChange(),this.adShown=!0),this.panel.update(),this.sprites)for(e=0;e<this.sprites.length;e++){var s=this.sprites[e];s.update()}if(null!==P.mouseDown){var i=P.hover;for(null===i&&(i=P.mouseDown),e=0;e<this.sliderBar.length;e++)this.sliderBar[e].getGlobalScale(!0),this.sliderBar[e].bounds=this.sliderBar[e].getBounds(!1),this.sliderBar[e].bounds.contains(i.x,i.y)&&(this.sliderTab[e].pcntx=L.clamp((i.x-this.sliderBar[e].bounds.left)/this.sliderBar[e].globalScale.x/this.sliderBar[e].width,0,1),0===e?(w.sfxVolume=this.sliderTab[e].percentx,this.soundAdjustTracked||(this.soundAdjustTracked=!0)):(this.managers.audio.setMusicVolume(this.sliderTab[e].percentx),this.soundAdjustTracked||(this.soundAdjustTracked=!0)),this.managers.preloader.loadManager.saveGameStatus())}if(this.buttons)for(e=0;e<this.buttons.length;e++){var n=this.buttons[e];if(t=n.update(),null!==t)break}switch(null===t&&C.isPressed[z.space_bar]&&(t="click_close_event"),t){case"click_close_event":return P.click=null,C.reset(z.space_bar),P.playMidRollAdAfterPause&&P.arenaHelper.requestMidroll(),!1;case"click_help_event":this.game.showHelp(!1),P.analyticsHelper.analytic&&P.analyticsHelper.analytic.helpClick();break;case"click_quit_event":this.game.showConfirm("quit_header_string",this,this.onYesQuit,this.onNoQuit);break;case"click_sound_event":this.soundBtn.toggled=!1,this.managers.audio.setMute(!0,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0),P.analyticsHelper.analytic&&P.analyticsHelper.analytic.soundToggled(this.soundBtn.toggled);break;case"click_sound_event_mute":this.soundBtn.toggled=!0,this.managers.audio.setMute(!1,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0),P.analyticsHelper.analytic&&P.analyticsHelper.analytic.soundToggled(this.soundBtn.toggled);break;case"click_music_event":this.musicBtn.toggled=!1,this.managers.audio.muteTunes(!0,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0),P.analyticsHelper.analytic&&P.analyticsHelper.analytic.musicToggled(this.musicBtn.toggled);break;case"click_music_event_mute":this.musicBtn.toggled=!0,this.managers.audio.muteTunes(!1,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0),P.analyticsHelper.analytic&&P.analyticsHelper.analytic.musicToggled(this.musicBtn.toggled)}return!0},c.prototype.onYesQuit=function(){if(P.quitConfirmed=!0,P.analyticsHelper.analytic){var e=Math.min(this.game.level+1,this.game.numLevels),t=Date.now(),s=Math.round((t-P.timeStartLevelMs)/1e3),i=Math.round((t-P.timeStarted)/1e3);P.analyticsHelper.analytic.quitGamePanelConfirmed(),P.analyticsHelper.analytic.levelEndNotFinished(e,s),P.analyticsHelper.analytic.gameQuited(I.score,e,i)}this.destroy(),I.requestQuit=!0,I.options=null},c.prototype.onNoQuit=function(){};var O=350;c.tweenIn={from:{pcnty:1},to:{pcnty:0},duration:O,easing:"easeInQuad",step:null,finish:function(){this.context.doneIn=!0}},c.tweenOut={from:{pcnty:0},to:{pcnty:-1},duration:O,easing:"easeFrom",step:null,finish:function(){this.context.doneOut=!0,this.owner&&(this.owner.destroy(),this.owner=null)}},d.prototype.create=function(e,t){this.managers=e,this.puzzle=t,this.hoveredPiece=null,this.dropPiece=null,this.selectedPiece=null,this.lastHovered=null,this.chain=1,this.multiMatch=0,this.selectedPiece=null,this.spriteList=[]},d.prototype.destroy=function(){if(this.removeHoverPiece(),this._removeSelectedPiece(),this.managers=null,this.puzzle=null,this.hoveredPiece=null,this.dropPiece=null,this.selectedPiece=null,this.lastHovered=null,this.spriteList){for(var e=0,t=this.spriteList.length;t>e;e++)this.spriteList[e].destroy();this.spriteList=null}},d.prototype.update=function(){if(this.spriteList&&this.spriteList.length>0){for(var e=this.spriteList.length-1;e>=0;--e){var t=this.spriteList[e];t instanceof n?(t.alpha-=.02,t.alpha<=0?(t.destroy(),this.spriteList.splice(e,1)):t.update()):t instanceof PIXI.Container&&(t.y-=4,0===t.children.length&&(t.destroy(),this.spriteList.splice(e,1)))}return this.spriteList.length>0}return!1},d.prototype.clickedPiece=function(e){if(this.puzzle.tornadoRemove)return!1;if(this.puzzle.tileOpen(e)){if(!this.userInteractedWithBoard&&P.isFirstTimeInGame&&P.analyticsHelper.analytic&&(P.analyticsHelper.analytic.madeFirstMove(),P.isFirstTimeInGame=!1,this.managers.preloader.loadManager.saveGameStatus()),this.selectedPiece){if(e!=this.selectedPiece)if(this.managers.audio.play("snd_clickTile"),e.symbol==this.selectedPiece.symbol||e.isOverridden()&&this.selectedPiece.isOverridden()){this._matchedPieces(e);var t=e.timeBonus();t>=0&&(this._timeBonusScoring(e,t),I.timeLeft+=t);var s=this._chainBonusScoring(e);this._multiBonusScoring(e);var i=0;s&&(i+=this.puzzle.speedMatchValue*this.chain),I.score+=(0|e.value)+i+this.puzzle.multiMatchValue*this.multiMatch,P.debug&&console.log("chain =",this.chain,"value =",e.value,"speedMatchValue =",this.puzzle.speedMatchValue,"score =",I.score);var n=16;this.managers.audio.play(this.chain<=n?["snd_match"+Math.min(this.chain,n).toString()]:["snd_correct1","snd_correct2"]),this.lastMatchTime=P.time,this.lastMatchType=e.symbol}else this._deselectPiece(this.selectedPiece),this._selectPiece(e)}else this.managers.audio.play("snd_clickTile"),this._selectPiece(e);return!0}return e&&e.wobble(),this.managers.audio.playDelayed(["snd_error1","snd_error2","snd_error3"],.1,this.cancelIfSwipe,this),!1},d.prototype.createHoveredPiece=function(e){this.hoveredPiece={piece:null,sprite:e,fallSpeed:0}},d.prototype.createDroppedPiece=function(e){this.dropPiece={piece:null,sprite:e,fallSpeed:0}},d.prototype.showDropAndHoverPieces=function(){if(this.dropPiece){this.dropPiece.sprite.setFrame(this.dropPiece.sprite.key,!0);var e=this.dropPiece.sprite.y;this.dropPiece.sprite.y=E.SelectionPreviewY,E.SelectionPreviewBotY=this.dropPiece.sprite.y+this.dropPiece.sprite.height,this.dropPiece.sprite.y=e,P.isPortrait?(this.dropPiece.sprite.y=E.SelectionPreviewBotY,this.dropPiece.fallSpeed=0):(this.dropPiece.sprite.y+=this.dropPiece.fallSpeed,this.dropPiece.fallSpeed++,this.dropPiece.sprite.y>E.SelectionPreviewBotY&&(this.dropPiece.sprite.y=E.SelectionPreviewBotY,this.dropPiece.fallSpeed=0)),this.dropPiece.sprite.update()}this.hoveredPiece&&(this.hoveredPiece.sprite.setFrame(this.hoveredPiece.sprite.key,!0),this.hoveredPiece.sprite.y=E.SelectionPreviewY,this.hoveredPiece.sprite.update())},d.prototype.resetSidePieces=function(){this.dropPiece&&this.dropPiece.sprite&&this.dropPiece.piece&&this.dropPiece.sprite.setFrame(this.dropPiece.piece.isOverridden()?"cube_"+this.dropPiece.piece.parent.overrideTileKey+"_1":"cube_"+this.dropPiece.piece.symbol+"_1"),this.hoveredPiece&&this.hoveredPiece.sprite&&this.hoveredPiece.piece&&this.hoveredPiece.sprite.setFrame(this.hoveredPiece.piece.isOverridden()?"cube_"+this.hoveredPiece.piece.parent.overrideTileKey+"_1":"cube_"+this.hoveredPiece.piece.symbol+"_1")},d.prototype.cancelIfSwipe=function(e){return e&&null!==P.mouseDown?!0:P.swipeEnabled&&0!==P.swipe?!0:!1},d.prototype._selectPiece=function(e){this.selectedPiece=e,this.selectedPiece.addFilter(E.brighter),this.dropPiece&&(this.dropPiece.piece=null,this.dropPiece.sprite.destroy(),this.dropPiece=null);var t=new n,s=e.symbol;"s0"==s&&(s="s0b"),t.create(P.topUI,null,"cube_"+e.symbol+"_1",this.managers.textures,E.SelectionPreviewX,E.SelectionPreviewY,!1),e.isOverridden()&&t.setFrame("cube_"+e.parent.overrideTileKey+"_1"),t.anchor.x=t.anchor.y=.5,t.scale.x=t.scale.y=S.scale/P.tileAssetScale,this.dropPiece={piece:e,sprite:t,fallSpeed:0},this.removeHoverPiece()},d.prototype._deselectPiece=function(e){e&&e.removeFilter(E.brighter),this._removeSelectedPiece()},d.prototype._removeSelectedPiece=function(){this.dropPiece&&(this.dropPiece.piece=null,this.dropPiece.sprite&&this.dropPiece.sprite.destroy(),this.dropPiece=null)},d.prototype._matchedPieces=function(e){P.debug&&console.log("Matched symbol",e.symbol),this.puzzle.fadeTile(this.selectedPiece,this.puzzle.removeTile),this._selectPiece(e),this.puzzle.fadeTile(e,this.puzzle.removeTile),this._removeSelectedPiece(),this.removeHoverPiece(),this.selectedPiece=null,I.levelMatches++},d.prototype.showHoveredPiece=function(e){if(e)if(this.selectedPiece&&this.selectedPiece==e)this.lastHovered&&(this.lastHovered.removeFilter(E.brighter2),this.lastHovered=null);else if(this.lastHovered&&this.lastHovered!==e&&(this.lastHovered.removeFilter(E.brighter2),this.lastHovered=null),e.addFilter(E.brighter2),this.lastHovered=e,!this.hoveredPiece||!this.hoveredPiece.piece||this.hoveredPiece.piece.symbol!=e.symbol){this.hoveredPiece&&this.removeHoverPiece();var t=new n;t.create(P.topUI,null,"cube_"+e.symbol+"_1",this.managers.textures,E.SelectionPreviewX,E.SelectionPreviewY,!1),e.isOverridden()&&t.setFrame("cube_"+e.parent.overrideTileKey+"_1"),t.anchor.x=t.anchor.y=.5,t.scale.x=t.scale.y=S.scale/P.tileAssetScale,this.hoveredPiece={piece:e,sprite:t,fallSpeed:0}}},d.prototype.removeHoverPiece=function(){if(this.lastHovered&&(this.lastHovered.removeFilter(E.brighter2),this.lastHovered=null),this.hoveredPiece){if(this.hoveredPiece.piece=null,this.sprites){var e=this.hoveredPiece.sprite;this.sprites.push(e),this.hoveredPiece.sprite.addFader(-.1,1,this.destroySprite,this,e,0)}else this.hoveredPiece.sprite.destroy();this.hoveredPiece=null}},d.prototype._chainBonusScoring=function(e){var t=!1;if(-1!==this.lastMatchTime&&P.time<=this.lastMatchTime+1e3*this.puzzle.speedMatchTime){this.chain++,t=!0;var s,i=this.chain.toString(),a="noglowtext/SM"+i[0];i.length>1&&(s="noglowtext/SM"+i[1]);var r=new PIXI.Container;e.parent.addChild(r),r.x=e.x,r.y=e.y,r.tz=-1e3,P.lowResolutionAssets&&r.scale.set(.5),this.spriteList&&this.spriteList.push(r);var o=new n;o.create(r,"gameAtlas","noglowtext/speedmatch",this.managers.textures,0,0,!1),o.anchor.set(.5),o.tz=-1e3,this.spriteList&&this.spriteList.push(o),o=new n,o.create(r,"gameAtlas",a,this.managers.textures,29.5,-15.5,!1),o.anchor.set(.5),o.tz=-1e3,this.spriteList&&this.spriteList.push(o),s&&(o=new n,o.create(r,"gameAtlas",s,this.managers.textures,77.5,-15.5,!1),o.anchor.set(.5),o.tz=-1e3,this.spriteList&&this.spriteList.push(o)),e.parent.reSort()}else this.chain=1;return t},d.prototype._multiBonusScoring=function(e){if(e.symbol==this.lastMatchType){this.multiMatch+=0===this.multiMatch?2:1;var t,s=this.multiMatch.toString(),i="noglowtext/MM"+s[0];s.length>1&&(t="noglowtext/MM"+s[1]);var a=new PIXI.Container;e.parent.addChild(a),a.x=e.x,a.y=e.y,a.tz=-1e3,P.lowResolutionAssets&&a.scale.set(.5),this.spriteList&&this.spriteList.push(a);var r=new n;r.create(a,"gameAtlas","noglowtext/multimatch",this.managers.textures,0,150,!1),r.anchor.set(.5),r.tz=-1e3,this.spriteList&&this.spriteList.push(r),r=new n,r.create(a,"gameAtlas",i,this.managers.textures,30.5,140.5,!1),r.anchor.set(.5),r.tz=-1e3,this.spriteList&&this.spriteList.push(r),t&&(r=new n,r.create(a,"gameAtlas",t,this.managers.textures,78.5,140.5,!1),r.anchor.set(.5),r.tz=-1e3,this.spriteList&&this.spriteList.push(r)),e.parent.reSort()}else this.multiMatch=0},d.prototype._timeBonusScoring=function(e,t){isNaN(t)&&P.debug&&alert("ERROR: _timeBonus NaN!");var s,i,a,r=L.timeToString(t);s="noglowtext/MM"+r[0],i="noglowtext/MM"+r[2],a="noglowtext/MM"+r[3];var o=new PIXI.Container;e.parent.addChild(o),o.x=e.x,o.y=e.y,o.tz=-1e3,P.lowResolutionAssets&&o.scale.set(.5),this.spriteList&&this.spriteList.push(o);var l=new n;l.create(o,"gameAtlas","noglowtext/time-bonus",this.managers.textures,0,150,!1),l.anchor.set(.5),l.tz=-1e3,l.alpha=1.2,this.spriteList&&this.spriteList.push(l),l=new n,l.create(o,"gameAtlas",s,this.managers.textures,-40.5,130.5,!1),l.anchor.set(.5),l.tz=-1e3,l.alpha=1.2,this.spriteList&&this.spriteList.push(l),l=new n,l.create(o,"gameAtlas","noglowtext/timecolon",this.managers.textures,-0.5,130.5,!1),l.anchor.set(.5),l.tz=-1e3,l.alpha=1.2,this.spriteList&&this.spriteList.push(l),l=new n,l.create(o,"gameAtlas",i,this.managers.textures,39.5,130.5,!1),l.anchor.set(.5),l.tz=-1e3,l.alpha=1.2,this.spriteList&&this.spriteList.push(l),l=new n,l.create(o,"gameAtlas",a,this.managers.textures,91.5,130.5,!1),l.anchor.set(.5),l.tz=-1e3,l.alpha=1.2,this.spriteList&&this.spriteList.push(l),e.parent.reSort()},p.prototype.create=function(e){this.managers=e},p.prototype.destroy=function(){this.managers=null},p.prototype.loadGameStatus=function(){P.debug&&console.log("loadGameStatus");try{var e=localStorage.getItem("MahjonggDarkDimensions_status");if(e){var t=JSON.parse(e);return P.debug&&console.log("sfx = ",t.sfxVolume,t.sfxMute,"music = ",t.musicVolume,t.musicMute,"show help =",t.showHelp,"isFirstTimeInGame =",t.isFirstTimeInGame),this.managers.audio.setMute(t.sfxMute,!0),this.managers.audio.muteTunes(t.musicMute,!0),w.sfxVolume=t.sfxVolume,this.managers.audio.setMusicVolume(t.musicVolume),P.showHelp=t.showHelp,P.isFirstTimeInGame=t.isFirstTimeInGame,!0}}catch(s){}return P.debug&&console.log("Game data is not available in localStorage."),!1},p.prototype.saveGameStatus=function(){var e={sfxVolume:w.sfxVolume,musicVolume:w.musicVolume,sfxMute:this.managers.audio.mute,musicMute:this.managers.audio.tunesMuted,showHelp:P.showHelp,isFirstTimeInGame:P.isFirstTimeInGames};P.debug&&console.log("saveGameStatus",e);var t=JSON.stringify(e);try{localStorage.setItem("MahjonggDarkDimensions_status",t)}catch(s){}return!0},g.prototype.create=function(e){this.dataManager=e,this.onLocaleChanged()},g.prototype.get=function(e){if(!this.dataManager)return P.debug&&console.log("ERROR: Locale.get called before dataManager is set!"),"error";this.strings||(this.strings=this.dataManager.get("strings"));var t=L.indexOfParameter(this.strings.Strings.String,"_id",e);return-1!==t?this.strings.Strings.String[t].__text:(P.debug&&console.log("WARNING: Locale.get unknown string id = "+e),null)},g.prototype.onLocaleChanged=function(){P.countryCode=P.arenaHelper.getLocale();for(var e=[{value:"en",localization:"en-US",name:"English"},{value:"de",localization:"de-DE",name:"Deutsch"},{value:"es",localization:"es-ES",name:"Español"},{value:"fr",localization:"fr-FR",name:"Français"},{value:"it",localization:"it-IT",name:"Italiano"}],t=0;t<e.length;t++)if(e[t].value===P.countryCode){P.countryCode=e[t].localization;break}var s=this.dataManager.get("localizations");P.debug&&console.log("available languages: ",s),s&&s.availableLocales&&-1==L.indexOfStringNoCase(s.availableLocales,P.countryCode)&&(P.debug&&console.log("language is not available: ",P.countryCode),P.countryCode="en-US"),P.debug&&console.log("language code = ",P.countryCode),this.dataManager.loadData("strings",P.arenaHelper.getAbsoluteURL("")+"data/locale/"+P.countryCode+"/strings.json"),this.strings=null},m.prototype.checkFonts=function(){if(this.fontList)for(var e=this.fontList.length-1;e>=0;--e){var t=this.fontList[e];m.getTextExtent("giItT1WQy@!-/#%",t,300)!=this.width&&(P.debug&&console.log("Font loaded:",this.fontList[e]),this.fontList.splice(e,1))}else P.debug&&console.log("FontLoaded.checkFonts() list is empty",this.fontList);return this.fontList&&0!==this.fontList.length?(P.debug&&console.log("Waiting for fonts:",this.fontList),!1):(this.interval&&clearInterval(this.interval),this.interval=null,this.fontList=null,this.loadedCallback&&(this.loadedCallback.call(this.loadedCallbackContext),this.loadedCallback=null,this.loadedCallbackContext=null),P.debug&&console.log("All fonts loaded or failed."),!0)},m.getTextExtent=function(e,t,s){var i=document.createElement("span");i.innerHTML=e,i.style.position="absolute",i.style.left="-10000px",i.style.top="-10000px",i.style.fontSize=s.toString()+"px",i.style.fontFamily=t,i.style.fontVariant="normal",i.style.fontStyle="normal",i.style.fontWeight="normal",i.style.letterSpacing="0",document.body.appendChild(i);var n=i.offsetWidth;return i.parentNode.removeChild(i),n},y.prototype.destroy=function(){this.callback=null,this.context=null,this.args=null},y.prototype.setFade=function(e,t,s,i,n,a){null!==e&&void 0!==e&&(this.fadedir=e),null!==t&&void 0!==t&&(this.fadeValue=t),this.callback=s,this.context=i,this.args=n,null!==a&&(this.trigger=a,void 0!==this.trigger&&(this.direction=this.fadeValue>=this.trigger?-1:1))},y.prototype.reached=function(e){return this.fadeValue==e},y.prototype.fading=function(){var e=!0;if(0!==this.fadedir&&(this.fadeValue+=this.fadedir,(isNaN(this.trigger)||void 0===this.direction)&&(this.fadeValue<=0?(this.fadeValue=0,this.fadedir=0,P.debug&&console.log("FadeState: finished fading out"),e=!1):this.fadeValue>=1&&(this.fadeValue=1,this.fadedir=0,P.debug&&console.log("FadeState: finished fading in"),e=!1))),!isNaN(this.trigger)&&void 0!==this.direction)if(-1===this.direction){if(this.fadeValue<=this.trigger&&this.callback.call(this.context,this.args))return this.callback=null,!1}else if(this.fadeValue>=this.trigger&&this.callback.call(this.context,this.args))return this.callback=null,!1;return e},f.REMOVE_TILE=1,f.PRELOADER=2,f.definitions=[{},{first:1,last:30,baseKey:"match/matchEffect",endKey:"",numPrecedingZeroes:4,scale:2.2},{first:0,last:67,baseKey:"frame_",endKey:"_delay-0.03s",numPrecedingZeroes:0,scale:1,repeat:!0}],f.prototype.create=function(e){this.textureManager=e,this.list=[]},f.prototype.destroy=function(){for(var e=this.list.length-1;e>=0;--e)this.list[e].destroy();this.list=null},f.prototype.add=function(e,t,s,i,a){var r=new n,o=f.definitions[e];r.create(t.parent,s,this.getKeyName(e,o.first),this.textureManager,t.x+i,t.y+a,!1),t.parent.setChildIndex(r,t.parent.getChildIndex(t)),r.anchor.set(t.anchor.x,t.anchor.y),r.scale.set(o.scale,o.scale),r.fxType=e,r.fxFrameNumber=o.first,r.repeat=o.repeat===!0?!0:!1,r.tz=t.tz,P.lowResolutionAssets&&e!=f.PRELOADER&&r.scale.set(.5*r.scale.x,.5*r.scale.y),this.list.push(r)},f.prototype.update=function(){for(var e=this.list.length-1;e>=0;--e){var t=this.list[e];if(t.fxFrameNumber>f.definitions[t.fxType].last){if(!t.repeat){t.destroy(),this.list.splice(e,1);continue}t.fxFrameNumber=0}var s=this.getKeyName(t.fxType,Math.floor(t.fxFrameNumber));t.setFrame(s),t.update(),t.fxFrameNumber+=.06*P.elapsedTime}return this.list.length},f.prototype.getKeyName=function(e,t){var s=f.definitions[e];return s.numPrecedingZeroes>0?s.baseKey+L.padToLength(t.toString(),s.numPrecedingZeroes,"0",!1)+s.endKey:s.baseKey+t.toString()+s.endKey},v.prototype.create=function(){this.pending=0,this.loader=PIXI.loader},v.prototype.destroy=function(){this.pending=0,this.loader=null},v.prototype.addImage=function(e,t){this.loader.add(e,t),P.debug&&console.log("Textures.addImage ",e,t),this.pending++},v.prototype.startLoading=function(e,t){var s=this;P.debug&&console.log("Textures.startLoading"),this.pending>0?this.loader.once("complete",function(){s.pending=0,P.debug&&console.log("Textures all loaded!"),e&&t&&e.call(t)}).load():P.debug&&console.log("WARNING: Textures.startLoading - no images to load!")},v.prototype.loadImage=function(e,t,s,i){P.debug&&console.log("Textures.loadImage",e,t),this.loader.add(e,t),this.loader.once("complete",function(){P.debug&&console.log("Texture loaded!"),s.call(i)}).load()},v.prototype.get=function(e,t,s){if(e){var i=PIXI.loader.resources[e];if(!i)return null;if(i.textures[t])return i.textures[t]}var n=PIXI.loader.resources[t];if(!n)return null;if(n.texture)return n.texture;if(s)return null;P.debug&&console.log("texture created from canvas",e,t);var a=PIXI.Texture.fromCanvas(PIXI.loader.resources[t]);return PIXI.loader.resources[t].texture=a,a},v.prototype.set=function(e,t){var s=PIXI.loader.resources[e];s&&s!=t&&(P.debug&&console.log("Textures.set removing image from cache",e),this.remove(e)),P.debug&&console.log("Textures.set adding image to cache",e,t.width,"x",t.height),s=PIXI.loader.resources[e]=t
},v.prototype.exists=function(e,t,s){if(e){var i=PIXI.loader.resources[e];if(!i)return!1;if(i.textures[t].texture)return!0}else{if(!PIXI.loader.resources[t])return!1;if(PIXI.loader.resources[t].texture)return!0}return!s},v.isCanvas=function(e){return e?e instanceof HTMLCanvasElement||"HTMLCanvasElement"==e.constructor.name||"HTMLCanvasElement"==(e.prototype?e.prototype.constructor:e.constructor).toString():(P.debug&&alert("ERROR: null or undefined object being tested for HTMLCanvasElement!"),!1)},v.prototype.remove=function(e){var t=PIXI.loader.resources[e];return t?t.texture?(v.isCanvas(t.texture)||t.texture.destroy({texture:!0,baseTexture:!0}),t.texture=null,v.isCanvas(t)?P.debug&&console.log("Textures.remove removing a Texture with a Canvas",e):(P.debug&&console.log("Textures.remove removing a Texture",e),t.destroy({texture:!0,baseTexture:!0})),PIXI.loader.resources[e]=null,void delete PIXI.loader.resources[e]):(P.debug&&(v.isCanvas(t)?console.log("Textures.remove removing a Canvas",e):console.log("Textures.remove can't remove a null texture",e)),PIXI.loader.resources[e]=null,void delete PIXI.loader.resources[e]):void(P.debug&&alert("ERROR: Textures.remove can't remove a null resource",e))},b.createTweens=function(e,t,s,i,r,o){isNaN(i)&&(i=0),isNaN(r)&&(r=0);for(var l=[],u=[],c=0;c<e.length;c++){var d=e[c];if(d.button){var p=new h(h.TYPE_BUTTON);if(p.create(t,d.atlas,d.key,s,d.x+i,d.y+r,!1,d.key,d.button.over,d.button.down,d.button.clickEvent),p.anchor.x=p.anchor.y=.5,void 0!==d.visible&&(p.visible=d.visible),p.sfx=d.button.sfx,p.sfxHover=d.button.sfxHover,void 0!==d.button.text){var g=new a(s.locale.get(d.button.text),o||P.textStyleBoldButtons);g.create(p,0,0,!0),g.anchor.set(.5,.5),p.text=g}void 0!==d.fade&&p.addFader(d.fade,d.alpha),void 0!==d.tween&&(d.tween.step=L.makeFunctionForSprite(p),p.tweener=new Tweenable,p.tweener.tween(d.tween),p.tweener.owner=p),u.push(p)}else{var m=new n;m.create(t,d.atlas,d.key,s.textures,d.x+i,d.y+r,!1),m.anchor.x=m.anchor.y=.5,void 0!==d.visible&&(m.visible=d.visible),void 0!==d.fade&&m.addFader(d.fade,d.alpha),void 0!==d.tween&&(d.tween.step=L.makeFunctionForSprite(m),m.tweener=new Tweenable,m.tweener.tween(d.tween),m.tweener.owner=m),l.push(m)}}return{sprites:l,buttons:u}},_.prototype.create=function(){this.list=[]},_.prototype.destroy=function(){this.list=null},_.prototype.loadData=function(e,t,s){var i;if(this.list[e])return i=this.list[e];P.debug&&console.log("DataManager.loadData ",e,t),i={},i.isReady=!1,this.list[e]=i;var n=this,a=new XMLHttpRequest;return a.overrideMimeType("application/json"),a.open("GET",t,!0),a.onreadystatechange=function(){4==a.readyState&&"200"==a.status&&(i.isReady=!0,i.data=JSON.parse(a.responseText),s&&s(),n.pending--)},a.send(null),this.pending++,i.src=t,i},_.prototype.get=function(e){return this.list&&this.list[e]&&this.list[e].isReady!==!1?this.list[e].data||this.list[e]:(P.debug&&console.log("DataManager.get(): data not in cache",e),null)},_.prototype.set=function(e,t){if(this.list[e])return void(P.debug&&console.log("WARNING: attempt to overwrite existing cache item",e));for(var s in this.list)if(this.list[s]==t)return P.debug&&console.log("WARNING: adding additional key to existing cache item",s,"==",e),void(this.list[e]=this.list[s]);this.list[e]=t,P.debug&&console.log("DataManager.set(): data added to cache",e)},w.sfxVolume=.5,w.musicVolume=.5,w.prototype.create=function(e){this.managers=e,this.list=[],this.delayed=[],this.pending=0,this.mute=!1,this.tunesMuted=!1,w.sfxVolume=.5,w.musicVolume=.5},w.prototype.destroy=function(){if(this.managers=null,this.list){for(var e in this.list)if(this.list.hasOwnProperty(e)){var t=this.list[e];t.unload(),this.list[e]=null}this.list=null}this.delayed=null,this.gameTune=null,this.delayed=null},w.prototype.loadAudio=function(e,t,s){for(var i=[],n=0,a=s.length;a>n;n++)i.push(t+"."+s[n]);this.pending++,P.debug&&console.log("AudioManager.loadAudio ",e,t);var r=this;this.list[e]=new Howl({src:i,onload:function(){r.pending--}})},w.prototype.play=function(e){if(Array.isArray(e)){var t=L.randomFromList(e);return this._playOne(t)}return this._playOne(e)},w.prototype._playOne=function(e){if(e&&this.list&&this.list[e]&&P.muteUntil<=P.time){var t=this.list[e];if("loaded"!=t._state)return P.debug&&console.log("AudioManager.playOne",e,"SFX not loaded!"),null;t.volume(w.sfxVolume);var s=t.play();return P.debug&&(console.log("AudioManager.playOne",e,"=",s),s||console.log("SFX not playable!")),t}return null},w.prototype.playDelayed=function(e,t,s,i){Array.isArray(e)&&(e=L.randomFromList(e)),e&&this.list&&this.list[e]&&!this.mute&&this.delayed.push({key:e,time:P.time+1e3*t,cancelCallback:s,context:i})},w.prototype.update=function(){for(var e=P.time,t=this.delayed.length-1;t>=0;--t){var s=this.delayed[t];s&&s.cancelCallback&&s.cancelCallback.call(s.context,e>s.time)?this.delayed.splice(t,1):e>s.time&&(this._playOne(s.key),this.delayed.splice(t,1))}},w.prototype.visibilityMute=function(e){P.debug&&console.log("AudioManager.visibilityMute",e),e?void 0===this.rememberMute&&(this.rememberMute=this.mute,this.rememberTunesMuted=this.tunesMuted,this.setMute(!0,!0),this.muteTunes(!0,!0)):void 0!==this.rememberMute&&(this.setMute(this.rememberMute,!0),this.muteTunes(this.rememberTunesMuted,!0),this.rememberMute=void 0,this.rememberTunesMuted=void 0)},w.prototype.setMute=function(e,t){P.debug&&console.log("AudioManager.setMute",e),this.mute=e;for(var s in this.list)if(this.list.hasOwnProperty(s)){var i=this.list[s];i!==this.gameTune&&i.mute(e)}t||this.managers.loadSave.saveGameStatus()},w.prototype.muteTunes=function(e,t){P.debug&&console.log("AudioManager.muteTunes",e),this.tunesMuted=e,this.gameTune&&this.gameTune.mute(this.tunesMuted),t||this.managers.loadSave.saveGameStatus()},w.prototype.startTune=function(e,t){this.gameTune&&this.stopTune(),this.list[e].loop(!0),this.gameTune=this._playOne(e),this.gameTune&&this.gameTune.volume(w.musicVolume*P.volumeControl),void 0!==t?this.muteTunes(t,!0):this.muteTunes(this.tunesMuted,!0)},w.prototype.stopTune=function(){this.gameTune&&(this.gameTune.stop(),this.gameTune=null)},w.prototype.setMusicVolume=function(e){w.musicVolume=e,this.gameTune&&this.gameTune.volume(w.musicVolume*P.volumeControl)},w.prototype.sfxLoaded=function(){for(var e in this.list){var t=this.list[e];if("loaded"!=t._state)return!1}return!0},x.prototype.addPauseAndResumeActions=function(e,t){this._arenaXapi?(this._arenaXapi.addAction("GAME_PAUSE",e),this._arenaXapi.addAction("GAME_RESUME",t)):(window.ARK_game_arena_connector.registerAction("pause",e),window.ARK_game_arena_connector.registerAction("resume",t))},x.prototype.requestMidroll=function(){this._arenaXapi?this._arenaXapi.dispatch({type:"PAUSE_READY",payload:null}):window.ARK_game_arena_connector.fireEventToArena("pause_ready")},x.prototype.handleMidrollStart=function(){},x.prototype.handleMidrollFinish=function(){},x.prototype.sendEventChange=function(){this._arenaXapi?this._arenaXapi.dispatch({type:"EVENT_CHANGE",payload:null}):window.ARK_game_arena_connector.fireEventToArena("event_change")},x.prototype.sendGameStart=function(){this._arenaXapi?this._arenaXapi.dispatch({type:"GAME_START",payload:null}):window.ARK_game_arena_connector.fireEventToArena("game_start")},x.prototype.sendGameEnd=function(e){this._arenaXapi?(this._arenaXapi.dispatch({type:"CHANGE_SCORE",payload:e}),this._arenaXapi.dispatch({type:"GAME_END",payload:null})):(window.ARK_game_arena_connector.changeScore(e),window.ARK_game_arena_connector.fireEventToArena("game_end"))},x.prototype.shouldShowGameEnd=function(){return this._arenaXapi?!0:"true"==window.ARK_game_arena_connector.showGameEnd()},x.prototype.getAbsoluteURL=function(e){return this._arenaXapi?[this._arenaXapi.assetOriginUrl,e].join(""):e},x.prototype.getLocale=function(){return this._arenaXapi?this._arenaXapi.locale:window.ARK_game_arena_connector.getParam("locale","en-US")},x.prototype.initTestingEnvironment=function(){return this._arenaXapi?(this._arenaXapi.addAction("TEST_ACTION",this.processTestAction.bind(this)),void this._arenaXapi.dispatch({type:"TEST_READY",payload:null})):(ARK_game_arena_connector.registerAction("test_action",this.processTestAction.bind(this)),void ARK_game_arena_connector.initTestingEnvironment())},x.prototype.handleCustomEvent=function(e,t){return this._arenaXapi?void this._arenaXapi.dispatch({type:e,payload:null}):void ARK_game_arena_connector.fireEventToArena(e,t)},x.prototype.processTestAction=function(e){for(var t=0;t<e.length;t++){var s=e[t];if("test_object"==s.name){var i=s.value.split(";"),n=i[0];this.testActionCallback&&this.testActionCallback(n);break}}},x.prototype.getArenaName=function(){return this._arenaXapi?window.arenaName||"unknown":ARK_game_arena_connector.getParam("arena_name")||"unknown"},x.prototype.getArenaDomain=function(){return this._arenaXapi?window.location.hostname:null},x.prototype.getParam=function(e,t){if(!this._arenaXapi)return ARK_game_arena_connector.getParam(e,t);switch(e){case"configURL":return this._arenaXapi.configUrl;default:return t}},x.prototype.destroy=function(){this._arenaXapi&&(this._arenaXapi.removeAction("GAME_PAUSE"),this._arenaXapi.removeAction("GAME_RESUME"),this._arenaXapi.removeAction("TEST_ACTION"))};var H=function(){"use strict"};H.prototype.init=function(e){"use strict";this._arenaHelper=e},H.prototype.initTestingEnvironment=function(){"use strict";this._arenaHelper.testActionCallback=this.testArenaCallback.bind(this),this._arenaHelper.initTestingEnvironment()},H.prototype.testArenaCallback=function(e){"use strict";switch(e){case"game_end":break;case"play_game":P.showHelp=!1,C.isPressed[32]=!0;break;case"quit_game":I.requestQuit=!0,I.highScore=1,this._arenaHelper.sendGameEnd(1);break;case"draw_border":var t=P.width,s=P.height,i=new PIXI.Graphics;i.beginFill(16711680),i.lineStyle(10,65280,1),i.moveTo(0,0),i.lineTo(t,0),i.lineTo(t,s),i.lineTo(0,s),i.lineTo(0,0),i.endFill(),i.x=.5*-t,i.y=.5*-s,P.stage.addChild(i);break;default:this._arenaHelper.handleCustomEvent(e)}};var U=function(e){"use strict";if(this._dimensions={trafficSource:e.arena.name,gameVersion:e.version,deviceType:e.device},null!=e.testGroup&&void 0!=e.testGroup&&(this._dimensions.abtestVersion=e.testGroup),null!=e.arena.domain&&void 0!=e.arena.domain&&(this._dimensions.domain=e.arena.domain),void 0!=window.ArenaXApi&&null!=window.ArenaXApi)this._aiTracker=new window.appInsightsMJDarkDimension.ApplicationInsights({config:{instrumentationKey:e.appId,overridePageViewDuration:!0,enableSessionStorageBuffer:!1,disableAjaxTracking:!0,disableExceptionTracking:!0,disableCorrelationHeaders:!0,disableDataLossAnalysis:!0,maxBatchInterval:0,samplingPercentage:U.getExternalAppInsightsSamplingPercentage(e)||2,disableFetchTracking:!0}}),this._aiTracker.loadAppInsights();else{var t="appInsightsSDK";window[t]="appInsights";var s=window[t],i=window[s]||function(e){function t(e){s[e]=function(){var t=arguments;s.queue.push(function(){s[e].apply(s,t)})}}var s={config:e};s.initialize=!0;var i=document,n=window;setTimeout(function(){var t=i.createElement("script");t.src=e.url||"https://az416426.vo.msecnd.net/scripts/b/ai.2.min.js",i.getElementsByTagName("script")[0].parentNode.appendChild(t)});try{s.cookie=i.cookie}catch(e){}s.queue=[],s.version=2;for(var a=["Event","PageView","Exception","Trace","DependencyData","Metric","PageViewPerformance"];a.length;)t("track"+a.pop());t("startTrackPage"),t("stopTrackPage");var r="Track"+a[0];if(t("start"+r),t("stop"+r),t("addTelemetryInitializer"),t("setAuthenticatedUserContext"),t("clearAuthenticatedUserContext"),t("flush"),s.SeverityLevel={Verbose:0,Information:1,Warning:2,Error:3,Critical:4},!(!0===e.disableExceptionTracking||e.extensionConfig&&e.extensionConfig.ApplicationInsightsAnalytics&&!0===e.extensionConfig.ApplicationInsightsAnalytics.disableExceptionTracking)){t("_"+(a="onerror"));var o=n[a];n[a]=function(e,t,i,n,r){var l=o&&o(e,t,i,n,r);return!0!==l&&s["_"+a]({message:e,url:t,lineNumber:i,columnNumber:n,error:r}),l},e.autoExceptionInstrumented=!0}return s}({instrumentationKey:e.appId,overridePageViewDuration:!0,enableSessionStorageBuffer:!1,disableAjaxTracking:!0,disableExceptionTracking:!0,disableCorrelationHeaders:!0,disableDataLossAnalysis:!0,maxBatchInterval:0,samplingPercentage:U.getExternalAppInsightsSamplingPercentage(e)||2,disableFetchTracking:!0});window[s]=i,i.queue&&0===i.queue.length&&i.trackPageView({}),this._aiTracker=window[s]}};U.getExternalAppInsightsSamplingPercentage=function(e){"use strict";var t=null;if(console.log("app ID is :"+e.appId),e.externalAppInsightsConfig){try{for(var s=0;s<e.externalAppInsightsConfig.length;s++){var i=e.externalAppInsightsConfig[s];if(i.instrumentationKey==e.appId){var n=e.arena.name;n&&"unknown"!=n||(n=P.arenaHelper.getArenaDomain(),null==n&&(n=window.document.location?window.document.location.href:"")),n=n.replace(/^(?:https?:\/\/)?(?:www\.)?/i,""),console.log("AppInsights: current Domain: "+n),t=i.defaultSamplingPercentage;for(var a=0;a<i.selectedDomains.length;a++){var r=i.selectedDomains[a];if(n===r){t=i.selectedDomainsSamplingPercentage;break}}break}}}catch(o){console.log("AppInsights: ERROR: getExternalAppInsightsSamplingPercentage")}return console.log("AppInsights: external samplingPercentage = "+t),t}},U.prototype.constructor=U,U.prototype.sendPageView=function(e){"use strict";this._aiTracker&&(this._aiTracker.trackPageView({name:e,properties:this._dimensions}),this._aiTracker.flush())},U.prototype.sendEvent=function(e,t,s,i){"use strict";var n=i||{};n.action=t,this._aiTracker&&(this._aiTracker.trackEvent({name:e,properties:n},this._dimensions),this._aiTracker.flush())};var D=function(e){"use strict";this._dimensions={dimension1:e.arena.name,dimension2:e.version},null!=e.testGroup&&void 0!=e.testGroup&&(this._dimensions.dimension3=e.testGroup);var t="mahjongg-dark-dimensions-ga:clientId";if(window._gameGATracker)try{_gameGATracker("create",e.appId,{storage:"none",clientId:localStorage.getItem(t)}),_gameGATracker(function(e){localStorage.setItem(t,e.get("clientId"))})}catch(s){_gameGATracker("create",e.appId,"auto")}};D.prototype.constructor=D,D.prototype.sendPageView=function(e){"use strict";_gameGATracker("send","pageview",e)},D.prototype.sendEvent=function(e,t,s){"use strict";_gameGATracker("send","event",e,t,s,0,this._dimensions)};var N=function(){"use strict";this.APP_STARTED="App_Started",this.MAINSCREEN_READY="MainScreen_Ready",this.GAMEPLAY_READY="Gameplay_Ready",this.START_BUTTON="Start_Button",this.START_BUTTON_CLICK="Start_Button_Clicked",this.FIRST_MOVE="First_Move",this.HELP_SHOWN="Help_Shown",this.HELP_PAGE="Help_Page",this.HELP="Help",this.MENU_ACTIONS="Menu_Actions",this.GAME_SCREEN_ACTIONS="Game_Screen_Actions",this.RESHUFFLE="Reshuffle",this.GAME_END="Game_End",this.ROUND_N="Round",this.ROUND_N_END="Round_End",this.IMPRESSION="Impression",this.CLICK="Click",this.WIN="Win",this.LOSS="Loss",this.TIME_OUT="Time_Out",this.NEW_GAME="New_Game",this.RESTART="Restart",this.QUIT="Quit",this.START="Start",this.FINISHED="Finished",this.NOT_FINISHED="Not_Finished",this.RESUME="Resume",this.INTRO_SCREEN="IntroScreen",this.GAME_SCREEN="GameScreen",this.GAME_OVER_SCREEN="GameOver",this.QUIT_CONFIRMED="QuitConfirmed",this.SCORE="score",this.ROUND="round",this.TIME_SPENT="timespent",this.RESHUFFLE_USED="reshuffleUsed",this._impl=[],this._reshuffleUsed=!1};N.prototype.constructor=N,N.Providers={GOOGLE:"analyticsProvider.google",APPINSIGHTS:"analyticsProvider.AppInsights"},N.prototype.init=function(e){"use strict";for(var t=0;t<e.providers.length;t++){var s=e.providers[t];switch(e.appId=s.appId,s.type){case N.Providers.GOOGLE:this._impl.push(new D(e));break;case N.Providers.APPINSIGHTS:this._impl.push(new U(e))}}},N.prototype.sendPageView=function(e){"use strict";P.debug&&console.log("AnalyticsManager.sendPageView:",e);for(var t=0;t<this._impl.length;t++)this._impl[t].sendPageView(e)},N.prototype.sendEvent=function(e,t,s,i){"use strict";P.debug&&console.log("AnalyticsManager.sendEvent:",e,t,s,i);for(var n=0;n<this._impl.length;n++)this._impl[n].sendEvent(e,t,s,i)},N.prototype.appStarted=function(){"use strict";this.sendEvent(this.APP_STARTED,"")},N.prototype.mainScreenReady=function(){"use strict";this.sendEvent(this.MAINSCREEN_READY,"")},N.prototype.gameplayReady=function(e){"use strict";var t={};this.addProperty(t,this.ROUND,e),this.sendEvent(this.GAMEPLAY_READY,"","",t)},N.prototype.madeFirstMove=function(){"use strict";this.sendEvent(this.FIRST_MOVE,"")},N.prototype.helpShown=function(){"use strict";this.sendEvent(this.HELP_SHOWN,"")},N.prototype.helpPage=function(e){"use strict";this.sendEvent(this.HELP_PAGE,e)},N.prototype.helpClick=function(){"use strict";this.sendEvent(this.HELP,this.CLICK)},N.prototype.startButtonClick=function(e){"use strict";this.sendEvent(this.START_BUTTON_CLICK,e)},N.prototype.musicToggled=function(e){"use strict";this.sendEvent(this.MENU_ACTIONS,e?"Music_On":"Music_Off")},N.prototype.soundToggled=function(e){"use strict";this.sendEvent(this.MENU_ACTIONS,e?"Sound_On":"Sound_Off")},N.prototype.reshuffle=function(){"use strict";this._reshuffleUsed=!0,this.sendEvent(this.RESHUFFLE,"")},N.prototype.resume=function(){"use strict";this.sendEvent(this.GAME_SCREEN_ACTIONS,this.RESUME)},N.prototype.gameEndWin=function(e,t,s){"use strict";var i={};this.addProperty(i,this.SCORE,e),this.addProperty(i,this.ROUND,t),this.addProperty(i,this.TIME_SPENT,s),this.sendEvent(this.GAME_END,this.WIN,this.getLabelWithPipe(e,t),i)},N.prototype.gameEndLoss=function(e,t,s){"use strict";var i={};this.addProperty(i,this.SCORE,e),this.addProperty(i,this.ROUND,t),this.addProperty(i,this.TIME_SPENT,s),this.sendEvent(this.GAME_END,this.LOSS,this.getLabelWithPipe(e,t),i)},N.prototype.gameEndTimeOut=function(e,t,s){"use strict";var i={};this.addProperty(i,this.SCORE,e),this.addProperty(i,this.ROUND,t),this.addProperty(i,this.TIME_SPENT,s),this.sendEvent(this.GAME_END,this.TIME_OUT,this.getLabelWithPipe(e,t),i)},N.prototype.gameQuited=function(e,t,s){"use strict";var i={};this.addProperty(i,this.SCORE,e),this.addProperty(i,this.ROUND,t),this.addProperty(i,this.TIME_SPENT,s),this.sendEvent(this.GAME_END,this.QUIT,this.getLabelWithPipe(e,t),i)},N.prototype.levelStart=function(e){"use strict";var t={};this.addProperty(t,this.ROUND,e),this.sendEvent(this.ROUND_N,this.START,null,t)},N.prototype.levelEndFinished=function(e,t){"use strict";var s={};this.addProperty(s,this.ROUND,e),this.addProperty(s,this.TIME_SPENT,t),this.addProperty(s,this.RESHUFFLE_USED,this._reshuffleUsed),this._reshuffleUsed=!1,this.sendEvent(this.ROUND_N_END,this.FINISHED,t.toString(),s)},N.prototype.levelEndNotFinished=function(e,t){"use strict";var s={};this.addProperty(s,this.ROUND,e),this.addProperty(s,this.TIME_SPENT,t),this.addProperty(s,this.RESHUFFLE_USED,this._reshuffleUsed),this._reshuffleUsed=!1,this.sendEvent(this.ROUND_N_END,this.NOT_FINISHED,t.toString(),s)},N.prototype.introPanelShowed=function(){"use strict";this.sendPageView(this.INTRO_SCREEN)},N.prototype.gamePanelShowed=function(){"use strict";this.sendPageView(this.GAME_SCREEN)},N.prototype.gameOverPanelShowed=function(){"use strict";this.sendPageView(this.GAME_OVER_SCREEN)},N.prototype.quitGamePanelConfirmed=function(){"use strict";this.sendPageView(this.QUIT_CONFIRMED)},N.prototype.getLabelWithPipe=function(e,t){"use strict";return t?t+"|"+e:e.toString()},N.prototype.addProperty=function(e,t,s){"use strict";e[t]=s},Object.freeze(N.Providers);var F=function(e){"use strict";this._analyticsManager=new N,("jpay"!==window.gameType||"azerion"!==window.gameType)&&(e.providers=[{type:N.Providers.GOOGLE,appId:"UA-68188765-24"},{type:N.Providers.APPINSIGHTS,appId:"24e62bc3-3b38-4428-b18f-75ea12ba7501"}],this._analyticsManager.init(e))};F.prototype.constructor=F,Object.defineProperty(F.prototype,"analytic",{get:function(){"use strict";return this._analyticsManager}}),F.prototype.destroy=function(){"use strict";this._analyticsManager=null},T.prototype.preload=function(e,t){this.root=e,this.lowResolution=t,this.textureManager=new v,this.textureManager.create(),this.dataManager=new _,this.dataManager.create(),this.localeManager=new g,this.audioManager=new w,this.loadManager=new p,this.audioManager.create(this.getManagers()),this.loadManager.create(this.getManagers());var s=this.lowResolution?"images/reduced/low/":"images/reduced/high/";this.textureManager.addImage("introAtlas",this.baseUrl+s+"introAtlas.json"),this.textureManager.startLoading(this.preloaderReady,this)},T.prototype.preloaderReady=function(){var e=this;this.bg=new n,this.bg.create(P.background,"introAtlas","title_bg",this.textureManager),this.bg.anchor.set(.5,1),this.bg.y=P.height/2/this.bg.parent.scale.y,this.effects=new f,this.effects.create(this.textureManager),this.effects.add(f.PRELOADER,P.fullUI,"introAtlas",0,0);var t=this.lowResolution?"images/reduced/low/":"images/reduced/high/";if(this.textureManager.addImage("gameAtlas",this.baseUrl+t+"gameAtlas.json"),this.textureManager.addImage("menuAtlas",this.baseUrl+t+"menuAtlas.json"),this.textureManager.addImage("cubeAtlas",this.baseUrl+t+"cubeAtlas.json"),this.textureManager.startLoading(),this.isJPay||this.loadAudioAssets(),this.dataManager.loadData("levels",this.baseUrl+"data/mahjongg_dimensions_levelData.json"),this.dataManager.loadData("symbol_offsets",this.baseUrl+"data/symbol_offsets.json"),this.dataManager.loadData("text_styles",this.baseUrl+"data/text_styles.json",function(){P.createTextStyles(e.dataManager)}),this.dataManager.loadData("localizations",this.baseUrl+"data/locale/localization.json",function(){e.localeManager.create(e.dataManager)}),this.dataManager.loadData("externalAppInsightsConfig","https://arenacloud.cdn.arkadiumhosted.com/gamesfeeds-blob/remote-configs/appinsights-config/appinsights-config.json",function(){}),this.dataManager.loadData("localConfig",this.baseUrl+"config/config.json",function(){}),!this.isJPay){var s="";window.configURL&&(s=window.configURL());var i=P.arenaHelper.getParam("configURL",s);""!==i&&null!==i&&this.dataManager.loadData("externalConfig",i)}this.levels=3},T.prototype.loadAudioAssets=function(){this.audioManager.loadAudio("game_tune",this.baseUrl+"sounds/music_loop",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_clickPlay",this.baseUrl+"sounds/play_button_press",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_rollOver",this.baseUrl+"sounds/menu_rollover_generic",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_clickTile",this.baseUrl+"sounds/click_tile",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_correct1",this.baseUrl+"sounds/correct_sound_1",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_correct2",this.baseUrl+"sounds/correct_sound_2",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match1",this.baseUrl+"sounds/tilematch1",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match2",this.baseUrl+"sounds/tilematch2",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match3",this.baseUrl+"sounds/tilematch3",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match4",this.baseUrl+"sounds/tilematch4",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match5",this.baseUrl+"sounds/tilematch5",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match6",this.baseUrl+"sounds/tilematch6",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match7",this.baseUrl+"sounds/tilematch7",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match8",this.baseUrl+"sounds/tilematch8",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match9",this.baseUrl+"sounds/tilematch9",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match10",this.baseUrl+"sounds/tilematch10",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match11",this.baseUrl+"sounds/tilematch11",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match12",this.baseUrl+"sounds/tilematch12",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match13",this.baseUrl+"sounds/tilematch13",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match14",this.baseUrl+"sounds/tilematch14",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match15",this.baseUrl+"sounds/tilematch15",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match16",this.baseUrl+"sounds/tilematch16",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_error1",this.baseUrl+"sounds/error_sound_1",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_error2",this.baseUrl+"sounds/error_sound_2",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_error3",this.baseUrl+"sounds/error_sound_3",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_rotate",this.baseUrl+"sounds/rotate",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_startSting",this.baseUrl+"sounds/game_opening_sting",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_endSting",this.baseUrl+"sounds/level_end",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_reshuffle1",this.baseUrl+"sounds/reshuffle_1",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_reshuffle2",this.baseUrl+"sounds/reshuffle_2",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_timerWarning",this.baseUrl+"sounds/timer_warning",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_timeUp",this.baseUrl+"sounds/out_of_time_sting",["mp3","mp4","ogg"])},T.prototype.cleanUp=function(){this.root=null,this.effects&&(this.effects.destroy(),this.effects=null),this.bg&&(this.bg.destroy(),this.bg=null)},T.prototype.update=function(){this.effects&&this.effects.update()},T.prototype.allLoaded=function(){var e=0===this.textureManager.pending&&0===this.dataManager.pending&&0===this.audioManager.pending;return e&&this.bg?(this.mergeConfigs(),this.cleanUp(),!0):!1},T.prototype.mergeConfigs=function(){P.config=this.dataManager.get("localConfig");var e=this.dataManager.get("externalConfig");if(null!=e)for(var t in e)P.config[t]=e[t];var s=this.dataManager.get("externalAppInsightsConfig");null!=s&&(P.externalAppInsightsConfig=s)},T.prototype.getManagers=function(){return{preloader:this,textures:this.textureManager,data:this.dataManager,audio:this.audioManager,locale:this.localeManager,loadSave:this.loadManager}},S.prototype=Object.create(n.prototype),S.prototype.constructor=S,S.scale=.75,S.pieceSizePixels=188,S.prototype.destroy=function(){this.name=null,this.managers=null,this.symbol=null,n.prototype.destroy.call(this)},S.prototype.update=function(e){if(e&&(this.wobbleCount=0),this.wobbleCount>0)if(this.wobbleCount--,0===this.wobbleCount)this.x=this.startX,this.y=this.startY;else{var t=this.wobbleCount>10?4:2;this.x=this.startX+Math.random()*t-t/2,this.y=this.startY+Math.random()*t-t/2}if(this.timer&&!I.paused&&!A.pageHidden){var s=Math.floor(this.timer/1e3);this.timer-=P.elapsedTime,this.timer<0&&(this.timer=0);var i=Math.floor(this.timer/1e3);i!=s&&(this.parent.timeTile(this.symbol,i,null),this.setFrame(this.key,!0))}n.prototype.update.call(this)},S.prototype.clone=function(){var e=new S(this.parent,this.managers,this.cx,this.cy,this.cz,this.symbol,this.value);return e.name=this.name,e.create(this.parent,null,e.name,e.managers.textures),e.setPickerData(e.managers.data.get("maskData_1")),e.anchor.set(this.anchor.x,this.anchor.y),e.scale.set(this.scale.x,this.scale.y),e.sizex=this.sizex,e.sizey=this.sizey,e.scalez=this.scalez,e.timer=this.timer,e.rotate3d(this.angle),e},S.prototype.copyLocation=function(e){e.cx=this.cx,e.cy=this.cy,e.cz=this.cz,e.rotate3d(e.angle)},S.prototype.isOverridden=function(){return this.parent.overrideTileTimer>0&&null!==this.parent.overrideTileKey&&"s0"!=this.symbol},S.prototype.setPicture=function(e){this.setFrame(this.isOverridden()?"cube_"+this.parent.overrideTileKey+"_"+e.toString():"cube_"+this.symbol+"_"+e.toString()),this.setPickerData(this.managers.data.get("maskData_"+e.toString()))},S.prototype.rotate3d=function(e){void 0!==e&&(this.angle=e);var t=Math.round(180*this.angle/Math.PI),s=t-t%10+5;e=s*Math.PI/180;var i=Math.sin(e),n=Math.cos(e);this.tx=this.cx*n-this.cz*i,this.tz=this.cx*i+this.cz*n,this.x=this.tx*this.sizex,this.y=(this.cy+P.puzzleOffsetY-this.tz*this.scalez)*this.sizey,this.tz+=.001*this.y,this.setPicture(Math.round(180*e/Math.PI/10+5)%9+1)},S.prototype.picked=function(e,t){return this.pixelPicker(e,t)>0},S.prototype.wobble=function(){0===this.wobbleCount&&(this.startX=this.x,this.startY=this.y,this.wobbleCount=20)},S.prototype.timeBonus=function(){return"s0"==this.symbol?this.timer:-1},k.prototype=Object.create(PIXI.Container.prototype),k.prototype.constructor=k,k.maxTilesHigh=6,k.maxHalfTilesWide=12,k.prototype.create=function(t,s,i,n){this.world=t,this.managers=s,this.levelName=i._id,this.tileDescriptions=i.TileImages,this.parent=P.puzzle,this.x=0,this.y=0,this.tornadoRemove=!1,this.lastTornadoPiece=0,this.second=!1,this.createCubes(this.cacheSpriteList),this.createTiles(this.tileDescriptions,this.cacheSpriteList),this.removeTiles=[],this.tiles=[],this.lastTimeString="",this.overrideTileTimer=0,this.overrideTileKey=null;var a=parseFloat(i.nScale);P.pieceScale=a;var r=parseFloat(i.yOffset);P.puzzleOffsetY=r,e.resizeCanvas(),this.puzzleLayout=i.TileStructure,this.multiMatchValue=0,this.speedMatchValue=n.nSpeedBonusValue,this.speedMatchTime=n.nSpeedBonusTime,this.levelBonusValues=JSON.parse("["+n.aLevelCompleteBonuses+"]"),this.generatePuzzle(),P.puzzle.addChild(this),P.forceResize=!0},k.prototype.generatePuzzle=function(){var e=0,t=!1;do t=this.generatePuzzleInternal(),e++;while(1e3>e&&!t);P.debug&&console.log("generatePuzzle tries:"+e+" succeed:"+t)},k.prototype.generatePuzzleInternal=function(){var e,t,s=0,i=0;for(this.tilesDataInfo=[],this.resetPuzzle(["1","2"],["-","+"],this.puzzleLayout);;){if(0===i){if(s>=this.tileDescriptions.length)break;i=this.tileDescriptions[s]._num||0,e=this.tileDescriptions[s]._name,t=this.tileDescriptions[s]._value,s++}var n=!1;if(n="s0"==e?this.addTileToPuzzle(e,t,this.puzzleLayout,"2","+",t):this.addTileToPuzzle(e,t,this.puzzleLayout,"1","-"),!n)return!1;i--}return this.createTileViews(),!0},k.prototype.destroy=function(){var e;if(PIXI.Container.prototype.destroy.call(this),this.levelBonusValues=null,this.tileDescriptions=null,this.world=null,this.tiles){for(e=0;e<this.tiles.length;e++)this.tiles[e].destroy({texture:!0,baseTexture:!0});this.tiles=null}this.managers=null,this.puzzleLayout=null;for(var t=0;t<this.blankCubes.length;t++)this.blankCubes[t].destroy({texture:!0,baseTexture:!0}),this.blankTimeCubes[t].destroy({texture:!0,baseTexture:!0});if(this.blankCubes=null,this.blankTimeCubes=null,this.cacheSpriteList){for(e=0;e<this.cacheSpriteList.length;e++)this.cacheSpriteList[e].destroy({texture:!0,baseTexture:!0});this.cacheSpriteList=null}P.puzzle.removeChild(this)},k.prototype.update=function(){var e;if(this.cacheSpriteList&&this.cacheSpriteList.length>0&&this.second){for(P.debug&&console.log("Puzzle.prototype destroying cacheSpriteList items",this.cacheSpriteList.length),e=0;e<this.cacheSpriteList.length;e++)this.cacheSpriteList[e].destroy({texture:!0,baseTexture:!0});this.cacheSpriteList=null}this.second=!0,this.overrideTileTimer>0&&(this.overrideTileTimer-=P.elapsedTime,this.overrideTileTimer<=0&&(P.debug&&console.log("Puzzle.overrideTileTimer expired"),this.overrideTileTimer=0,this.overrideTileKey=null,this.forceDraw(),this.world.puzzleInput.resetSidePieces())),this.removePendingTiles();var t=!1;for(this.angle!=this.targetAngle&&(this.angle=L.rotateTo(this.angle,this.targetAngle,k.turnSpeed*P.elapsedTime*.06),this.rotate(this.angle),t=!0),e=this.tiles.length-1;e>=0;--e)this.tiles[e].update(t);return this.tornadoRemove&&this.tornado(),this.angle!=this.targetAngle||this.tornadoRemove?!0:!this.puzzleLocked()},k.prototype.setTargetAngle=function(e,t){this.targetAngle=L.normaliseAngle(e),t&&(this.angle=this.targetAngle,this.rotate(this.angle))},k.prototype.adjustTargetAngle=function(e){return this.angle==this.targetAngle?(this.targetAngle=L.normaliseAngle(this.targetAngle+e),!0):!1},k.prototype.isTurning=function(){return this.angle!=this.targetAngle},k.prototype.rotate=function(e){for(var t=L.normaliseAnglePositive(e),s=this.tiles.length-1;s>=0;--s)this.tiles[s].rotate3d(t);
this.reSort()},k.prototype.reSort=function(){this.children.sort(function(e,t){return e.tz=e.tz||0,t.tz=t.tz||0,t.tz-e.tz})},k.prototype.forceDraw=function(){for(var e=this.tiles.length-1;e>=0;--e)this.tiles[e].rotate3d();this.reSort()},k.prototype.createCubes=function(){this.blankCubes=[],this.blankTimeCubes=[];var e=this.managers.data.get("symbol_offsets");e=JSON.parse(JSON.stringify(e));for(var t=e.offy,s=0;s<t.length;s++)for(var i=0,a=t[s].length;a>i;i++)t[s][i]-=50;var r=new n;r.create(this,"gameAtlas","time_icon",this.managers.textures);for(var o=1;9>=o;o++){var l=new n,h="tile_"+L.padToLength(o.toString(),5,"0",!1);l.create(this,"cubeAtlas",h,this.managers.textures),this.blankCubes.push(l);var u=l.getPixels();this.managers.data.set("maskData_"+o.toString(),u),l.x=l.y=-1e3;var c=new n;h="time_tile_"+L.padToLength(o.toString(),5,"0",!1),c.create(this,"cubeAtlas",h,this.managers.textures,-1e3,-1e3,!1);var d=this.addSymbolToCube(r,o-1,c,e);this.managers.textures.set(h+"b",d),c.setFrame(h+"b",!0),this.blankTimeCubes.push(c)}r.destroy()},k.prototype.createTiles=function(e,t){for(var s=this.managers.data.get("symbol_offsets"),i=0;i<e.length;i++){var a=e[i]._name;if("s0"!=a){var r=new n,o=e[i]._name.replace("s","");r.create(this,"gameAtlas",o,this.managers.textures);for(var l=0;l<this.blankCubes.length;l++){var h="cube_"+e[i]._name+"_"+(l+1).toString();if(!this.managers.textures.exists(null,h,!1)){var u=this.addSymbolToCube(r,l,this.blankCubes[l],s);this.managers.textures.set(h,u)}var c=new n;c.create(P.puzzle,null,h,this.managers.textures,-1e3,-1e3),t.push(c)}r.destroy()}else this.timeTile(a,90,t)}},k.prototype.addSymbolToCube=function(e,t,s,i){var n=e.createCanvasFromTexture(),a=e.createCanvasFromTexture(),r=s.createCanvasFromTexture(),o=r.width/2,l=r.height/2,h=r.getContext("2d");return h.save(),h.scale(.5*i.scalex[0][t],.5),h.transform(1,i.skewy[0][t],0,1,0,0),h.drawImage(n,o+i.offx[0][t]*P.tileAssetScale-n.width/2,l+i.offy[0][t]*P.tileAssetScale-n.height/2),h.restore(),h.scale(.5*i.scalex[1][t],.5),h.transform(1,i.skewy[1][t],0,1,0,0),h.drawImage(a,o+i.offx[1][t]*P.tileAssetScale-a.width/2,l+i.offy[1][t]*P.tileAssetScale-a.height/2),h.restore(),r},k.prototype.timeTile=function(e,t,s){P.debug&&console.log("Puzzle.timeTile",t,e);var i=L.timeToString(1e3*t);if(i!=this.lastTimeString){this.lastTimeString=i;var n=this.managers.data.get("symbol_offsets"),a=new PIXI.Text("\n"+i,{fontFamily:"mjd_font1",fontSize:100/P.pixelRatio*P.tileAssetScale,fill:"#ffffff",align:"center"});a.renderCanvas(P.renderer);for(var r=a.canvas,o=0;o<this.blankTimeCubes.length;o++)this.addTimeToTile(e,n,o,r,!1,s);this.addTimeToTile(e,n,0,r,!0,null),this.cacheSpriteList||(this.cacheSpriteList=[]),this.cacheSpriteList.push(a)}},k.prototype.addTimeToTile=function(e,t,s,i,a,r){var o;o=a?"cube_s0b_1":"cube_"+e+"_"+(s+1).toString();var l=i,h=i,u=this.blankTimeCubes[s].createCanvasFromTexture(),c=u.width/2,d=u.height/2,p=u.getContext("2d");if(p.save(),p.scale(.5*t.scalex[0][s],.5),p.transform(1,t.skewy[0][s],0,1,0,0),p.drawImage(l,c+t.offx[0][s]*P.tileAssetScale-l.width/2,d+t.offy[0][s]*P.tileAssetScale-l.height/2),p.restore(),p.save(),p.scale(.5*t.scalex[1][s],.5),p.transform(1,t.skewy[1][s],0,1,0,0),p.drawImage(h,c+t.offx[1][s]*P.tileAssetScale-h.width/2,d+t.offy[1][s]*P.tileAssetScale-h.height/2),p.restore(),this.managers.textures.set(o,u),r){var g=new n;g.create(P.puzzle,null,o,this.managers.textures,-1e3,-1e3),g.destroyTexture=!0,r.push(g)}},k.prototype.tilePicker=function(e,t){for(var s=[],i=null,n=null,a=this.tiles.length-1;a>=0;--a)n=this.tiles[a],!n.fader&&n.picked(e,t)&&s.push(n);if(s.length>0){for(a=s.length-1;a>=0;--a)n=s[a],(!i||i.tz>n.tz)&&(i=n);return i}return null},k.prototype.tileOpen=function(e){var t=e.cx,s=e.cy,i=e.cz;return this.spaceOpen(t+1,s,i)&&this.spaceOpen(t,s,i+1)||this.spaceOpen(t-1,s,i)&&this.spaceOpen(t,s,i+1)||this.spaceOpen(t-1,s,i)&&this.spaceOpen(t,s,i-1)||this.spaceOpen(t+1,s,i)&&this.spaceOpen(t,s,i-1)},k.prototype.spaceOpen=function(e,t,s){for(var i=this.tiles.length-1;i>=0;--i){var n=this.tiles[i];if(!n.fader&&n.cx==e&&n.cy==t&&n.cz==s)return!1}return!0},k.prototype.removeTile=function(e){this.removeTiles||(this.removeTiles=[]),this.removeTiles.push(e)},k.prototype.removePendingTiles=function(){if(this.removeTiles&&0!==this.removeTiles.length){for(var e=this.removeTiles.length-1;e>=0;--e){var t=this.removeTiles[e];if(!(t.children.length>0)){var s=this.tiles.indexOf(t);-1!=s&&(t.destroy(),this.tiles.splice(s,1)),this.removeTiles.splice(e,1)}}P.eventChangeAdOnMatch&&P.arenaHelper.sendEventChange(),this.reSort()}},k.prototype.fadeTile=function(e,t){I.effects.add(f.REMOVE_TILE,e,"gameAtlas",0,0),e.addFader(-0.1,1,t,this,e,-.5),this.reSort()},k.prototype.resetPuzzle=function(e,t,s){for(var i=0;i<s._x;i++)for(var n=0;n<s._y;n++)for(var a=0;a<s._z;a++){var r=s.layer[a].row[n].charAt(i),o=t.indexOf(r);-1!=o&&(s.layer[a].row[n]=L.replaceAt(s.layer[a].row[n],i,e[o]))}},k.prototype.addTileToPuzzle=function(e,t,s,i,n,a){var r,o,l,h=1e3;do r=Math.floor(Math.random()*s._x),o=Math.floor(Math.random()*s._y),l=Math.floor(Math.random()*s._z);while(s.layer[l].row[o].charAt(r)!==i&&--h>0);if(0>=h){for(r=0;r<s._x;r++)for(o=0;o<s._y;o++)for(l=0;l<s._z&&s.layer[l].row[o].charAt(r)!=i;l++);return console.log("ERROR in level data, cannot add Tile to full puzzle!"),!1}return this.tilesDataInfo.push({x:r-(s._x-1)/2,y:-l,z:o-(s._y-1)/2,s:e,v:t,t:a}),s.layer[l].row[o]=L.replaceAt(s.layer[l].row[o],r,n),!0},k.prototype.createTileViews=function(){for(var e=0;e<this.tilesDataInfo.length;e++){var t=this.tilesDataInfo[e];this.tiles.push(new S(this,this.managers,t.x,t.y,t.z,t.s,t.v,t.t))}},k.prototype.matchingPair=function(e,t){for(var s=t.length-1;s>=0;--s)if(t[s].symbol==e.symbol)return!0;return!1},k.prototype.puzzleLocked=function(){for(var e=[],t=this.tiles.length;--t>=0;){var s=this.tiles[t];if(this.tileOpen(s)){if(this.matchingPair(s,e))return!1;e.push(s)}}return!0},k.prototype.finished=function(e){if(!this.tiles||0===this.tiles.length)return!0;if(e){for(var t=this.tiles.length-1;t>=0;--t)if(!this.tiles[t].fader)return!1;return!0}return!1},k.prototype.reshuffle=function(){for(var e=1e3,t=this.tiles.length;e-->0;){var s=Math.floor(Math.random()*t),i=Math.floor(Math.random()*t);if(s!=i){var n=this.tiles[s].clone();this.tiles[i].copyLocation(n),this.tiles[s].copyLocation(this.tiles[i]),this.tiles[s].destroy(),this.tiles[s]=this.tiles[i].clone(),this.tiles[i].destroy(),this.tiles[i]=n}}P.debug&&console.log("Puzzle pieces reshuffled"),this.setTargetAngle(this.targetAngle,!0)},k.prototype.highestTile=function(){for(var e=null,t=this.tiles.length-1;t>=0;--t){var s=this.tiles[t];s.fader||s.tornadoRemove||(!e||s.cy<e.cy&&e.tz>s.tz)&&(e=s)}return e},k.prototype.tornado=function(){if(this.setTargetAngle(this.angle+k.turnSpeed),!this.lastTornadoPiece||P.time-this.lastTornadoPiece>100){this.lastTornadoPiece=P.time;var e=this.highestTile();e&&(P.suppressBigAnimations?e.cy=-100:e.tornadoRemove=!0)}for(var t=this.tiles.length-1;t>=0;--t){var s=this.tiles[t];s.tornadoRemove&&(s.cy-=.2),s.cy<-13&&(s.destroy(),this.tiles.splice(t,1))}0===this.tiles.length&&(this.tornadoRemove=!1)},k.prototype.contains=function(e){var t=this.getBounds();return t.contains(e.x,e.y)},k.prototype.overrideTiles=function(e,t){P.debug&&console.log("Puzzle.overrideTiles with "+t+" for "+e+" secs."),this.overrideTileTimer=1e3*e,this.overrideTileKey=t,this.forceDraw(),this.world.puzzleInput.resetSidePieces()},A.GameStates={NONE:-1,PRELOAD:0,TITLES:1,PLAY:2},A.pageHidden=!1,A.prototype.create=function(){this.preloader=new T(P.arenaHelper.getAbsoluteURL("")),this.preloader.preload(this,P.lowResolutionAssets),this.lastState=A.GameStates.NONE,this.state=A.GameStates.PRELOAD,this.titles=null,this.game=null,this.bm=null},A.prototype.update=function(){var t;do{t=!1;var s=this.lastState!=this.state;switch(this.lastState=this.state,P.debug&&s&&console.log("GameControl.state changed to",this.state),this.state){case A.GameStates.PRELOAD:if(this.preloader.update(),this.preloader.allLoaded()){this.state=A.GameStates.TITLES;var i=new MobileDetect(window.navigator.userAgent),n="pc";i.phone()?n="phone":i.tablet()&&(n="tablet");var a={arena:{name:P.arenaHelper.getArenaName(),domain:P.arenaHelper.getArenaDomain()},device:n,version:P.VERSION,externalAppInsightsConfig:P.externalAppInsightsConfig};P.analyticsHelper=new F(a),P.analyticsHelper.analytic&&P.analyticsHelper.analytic.appStarted(),L.focusChangeCallback=this.onFocusChange,L.focusChangeContext=this,L.detectHidden(),A.pageHidden=L.isHidden(),this.preloader.loadManager.loadGameStatus(),this.preloader.levels=this.preloader.dataManager.get("levels").levels.length,P.debug&&console.log("Data has "+this.preloader.levels+" levels."),t=!0}break;case A.GameStates.TITLES:s&&(C.create(),e.clearCallbacks(),this.resetInput(),this.titles=new M,this.titles.create(this.preloader),this.preloader.audioManager.stopTune(),P.gameAutotestingManager.initTestingEnvironment()),this.preloader.audioManager.update(),this.titles.update()||(this.titles.destroy(),this.titles=null,this.state=A.GameStates.PLAY);break;case A.GameStates.PLAY:s&&(P.arenaHelper.sendGameStart(),this.resetInput(),this.game=new I,this.game.create(this.preloader.getManagers(),this.preloader.levels)),this.preloader.audioManager.update(),this.game.update()||(this.game.destroy(),this.game=null,this.state=A.GameStates.TITLES)}}while(t);P.mouseDown&&P.getFocus(),P.render()},A.prototype.resetInput=function(){C.reset(),P.resetInput()},A.prototype.onFocusChange=function(e){e||P.getFocus(),(P.pauseOnFocusLoss||(this.preloader.audioManager.visibilityMute(e),PIXI.utils.isMobile.any))&&(e?(this.bm&&this.bm.removing&&(this.bm.destroy(),this.bm=null),!this.bm&&this.game&&(this.bm=new r,this.bm.create(P.fullUI,this.preloader.getManagers(),"click_to_continue_string"))):(this.bm&&this.bm.remove(this,"bm")&&(P.mouseDown=null,P.mouseUp=null),I.paused=null!==I.options),P.time=1e3*Math.floor(P.time/1e3)+999,this.preloader.audioManager.visibilityMute(e),P.debug&&console.log("GameControl.onFocusChange hidden =",e,"at time =",Date.now()))},P.timeStarted=Date.now(),P.timeStartLevelMs=0,P.HTMLElement=null,P.prototype.createGame=function(t,s,i){new e,P.arenaHelper||(P.arenaHelper=new x),P.gameAutotestingManager=new H,P.gameAutotestingManager.init(P.arenaHelper),P.pixelRatio=window?window.devicePixelRatio:1,P.pixelRatio=Math.min(2,P.pixelRatio),P.app=new PIXI.Application(t||P.gameWide,s||P.gameHigh,{autoResize:!0,resolution:P.pixelRatio}),P.renderer=P.app.renderer,P.renderer instanceof PIXI.CanvasRenderer?(console.log("PIXI using Canvas Renderer"),PIXI.utils.isMobile.any&&console.log("Mobile device")):(console.log("PIXI using WebGl Renderer"),PIXI.utils.isMobile.any&&console.log("Mobile device"));var n=null;null!==i&&(n=document.getElementById(i)),P.HTMLElement=n,n?n.appendChild(P.app.view):document.body.appendChild(P.app.view),P.getFocus(),P.suppressBigAnimations=P.renderer instanceof PIXI.CanvasRenderer?!0:!1,P.debug&&console.log("Main.suppressBigAnimations =",P.suppressBigAnimations),P.isAndroid=PIXI.utils.isMobile.android.phone||PIXI.utils.isMobile.android.seven_inch||PIXI.utils.isMobile.android.tablet,P.debug&&console.log("Main.android device =",P.isAndroid),P.isChromeMobile=P.isAndroid,P.debug&&console.log("Main.isChromeMobile =",P.isChromeMobile),P.stage=P.app.stage,P.stage.x=P.gameWide/2,P.stage.y=P.gameHigh/2,P.background=new PIXI.Sprite,P.background.anchor.set(.5),P.stage.addChild(P.background),P.puzzle=new PIXI.Sprite,P.puzzle.anchor.set(.5,.5),P.stage.addChild(P.puzzle),P.bottomUI=new PIXI.Sprite,P.bottomUI.anchor.set(.5,1),P.stage.addChild(P.bottomUI),P.rightUI=new PIXI.Sprite,P.rightUI.anchor.set(.5),P.stage.addChild(P.rightUI),P.topUI=new PIXI.Sprite,P.topUI.anchor.set(.5,0),P.stage.addChild(P.topUI),P.fullUI=new PIXI.Sprite,P.fullUI.anchor.set(.5,.5),P.fullUIScale=1,P.stage.addChild(P.fullUI),e.resizeCanvas(),e.pixiListeners(P.renderer),P.nowTime=Date.now(),P.time=0,P.repeatedGamesLeft=P.playAgainCount,this.gameControl=new A,this.gameControl.create(),new m(["mjd_font1","mjd_font2","mjd_font3"],this.playGame,this)},P.prototype.playGame=function(){P.debug&&console.log("starting game loop");var t=null;P.showFPS&&(t=new Stats,t.showPanel(0),document.body.appendChild(t.dom));var s=this;e.resizeCanvas();var i=function(){P._lastTime=P.nowTime,P.nowTime=Date.now(),P.elapsedTime=Math.min(P.nowTime-P._lastTime,50),P.time+=P.elapsedTime,requestAnimationFrame(i),t&&t.begin(),s.gameControl.update(),P.resizeConsumed&&(P.resized=!1,P.resizeConsumed=!1),e.resizeCanvas(),t&&t.end()};requestAnimationFrame(i)},P.createTextStyles=function(e){var t=e.get("text_styles");P.textStyleBold=P.wrapTextStyle(t.textStyleBold),P.textStyleBoldHugeCentered=P.wrapTextStyle(t.textStyleBoldHugeCentered),P.textStyleBoldButtons=P.wrapTextStyle(t.textStyleBoldButtons),P.textStyleBoldButtonsLarge=P.wrapTextStyle(t.textStyleBoldButtonsLarge),P.textStyleBoldButtonTitles=P.wrapTextStyle(t.textStyleBoldButtonTitles),P.textStyleBoldLargeCentered=P.wrapTextStyle(t.textStyleBoldLargeCentered),P.textStyleMedium=P.wrapTextStyle(t.textStyleMedium),P.textStyleMedium2=P.wrapTextStyle(t.textStyleMedium2),P.textStyleMediumTiny=P.wrapTextStyle(t.textStyleMediumTiny),P.textStyleVersionTiny=P.wrapTextStyle(t.textStyleVersionTiny),P.textStyleLarge=P.wrapTextStyle(t.textStyleLarge),P.textStyleSemiBold=P.wrapTextStyle(t.textStyleSemiBold)},P.wrapTextStyle=function(e){var t=new PIXI.TextStyle;return L.setValuesFromObject(t,e),t},P.render=function(){P.renderer.render(P.stage),!P.HTMLElement||P.HTMLElement.clientWidth==P.width&&P.HTMLElement.clientHeight==P.height||e.resizeCanvas()},P.resetInput=function(){e.resetInput(),P.click=null,P.hover=null,P.mouseDown=null,P.mouseUp=null,P.swipe=0},P.getFocus=function(){P.app&&P.app.view&&(P.debug&&console.log("Main.getFocus - grab keyboard focus"),P.useFocus&&(P.app.view.setAttribute("tabindex","-1"),P.app.view.focus()),window.focus()),C.create()},P.number2StringWithSeparator=function(e,t,s,i){var n=e.toString().split("."),a=n[0];parseInt(n[1])>99&&(n[1]=Math.floor(parseInt(n[1].substr(0,2))));var r=n.length>1?i+n[1]:"";t?(""==r&&(r=i+"00"),r.length>0&&r.length<3&&(r+="0")):r="";for(var o=/(\d+)(\d{3})/;o.test(a);)a=a.replace(o,"$1"+s+"$2");return a+r},M.ready=!1;var O=800,B=100;M.pieces=[{atlas:"introAtlas",key:"logo_panel",x:0,y:-90,alpha:0,fade:.05},{atlas:"introAtlas",key:"logo_tiles",x:0,y:-131,tween:{from:{scaleFactor:.25},to:{scaleFactor:1},duration:O+4*B,easing:"bounce"}},{atlas:"introAtlas",key:"letter_m",x:-216,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:O+0*B,easing:"bounce"}},{atlas:"introAtlas",key:"letter_a",x:-161,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:O+1*B,easing:"bounce"}},{atlas:"introAtlas",key:"letter_h",x:-109,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:O+2*B,easing:"bounce"}},{atlas:"introAtlas",key:"letter_j",x:-60,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:O+3*B,easing:"bounce"}},{atlas:"introAtlas",key:"letter_n",x:67,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:O+5*B,easing:"bounce"}},{atlas:"introAtlas",key:"letter_g",x:128,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:O+6*B,easing:"bounce"}},{atlas:"introAtlas",key:"letter_g",x:190,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:O+7*B,easing:"bounce"}},{atlas:"introAtlas",key:"logo_dimensions",x:-10,y:-28,tween:{from:{scaleFactor:.25},to:{scaleFactor:1},duration:O+8*B,easing:"bounce"}},{atlas:"introAtlas",key:"play-button",x:4,y:130,button:{over:"play-button-rollover",down:"play-button-down",clickEvent:"click_start",text:"new_game_start_button_string",sfx:"snd_clickPlay",sfxHover:"snd_rollOver"},tween:{from:{scaleFactor:.15},to:{scaleFactor:.9*.8},finish:function(){M.ready||(M.ready=!0,P.analyticsHelper.analytic&&P.analyticsHelper.analytic.mainScreenReady())},duration:O+8*B,easing:"bounce"}}],M.prototype.create=function(t){M.ready=!1,this.preloader=t,this.managers=this.preloader.getManagers(),this.isJPay="jpay"===window.gameType?!0:!1,this.bg=new n,this.bg.create(P.background,"introAtlas","title_bg",this.managers.textures),this.bg.anchor.set(.5,1),this.bg.y=P.height/2/this.bg.parent.scale.y,this.logoArkadium=new n,this.logoArkadium.create(P.bottomUI,"introAtlas","logo_arkadium",this.managers.textures,-.505,-.505,!0),this.logoArkadium.visible=P.config.showArkadiumLogo,P.fullUIScale=1,P.forceResize=!0;var s=b.createTweens(M.pieces,P.fullUI,this.managers,0,0,P.textStyleBoldButtonTitles);this.sprites=s.sprites,this.buttons=s.buttons,e.registerCallback("mousedown",this.startTune,{context:this}),this.fader=new y,this.fader.setFade(.1),P.debug&&console.log("titles are fading in"),P.eventChangeAdOnTitlesShow&&P.arenaHelper.sendEventChange(),P.analyticsHelper.analytic&&P.analyticsHelper.analytic.introPanelShowed()},M.prototype.startTune=function(){e.clearCallback("mousedown",this.startTune),console.log("Titles.startTune"),this.managers&&this.managers.audio&&(this.managers.audio.sfxLoaded()||(console.log("retry loadAudioAssets from input gesture"),this.isJPay||this.preloader.loadAudioAssets()),console.log("play the tune..."),this.managers.audio.startTune("game_tune"))},M.prototype.destroy=function(){var e;if(P.fullUIScale=1,P.forceResize=!0,this.logoArkadium&&(this.logoArkadium.destroy(),this.logoArkadium=null),this.version&&(this.version.destroy(),this.version=null),this.bg&&(this.bg.destroy(),this.bg=null),this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.buttons){for(e=0;e<this.buttons.length;e++)this.buttons[e].destroy();this.buttons=null}this.fader&&(this.fader.destroy(),this.fader=null),this.managers=null},M.prototype.update=function(){var e,t="";if(!this.fader.fading()&&this.fader.reached(0))return!1;if(this.bg.alpha=this.fader.fadeValue,this.bg.y=P.height/2/this.bg.parent.scale.y,this.bg.update(),this.sprites)for(e=0;e<this.sprites.length;e++)this.sprites[e].update();if(this.buttons&&M.ready)for(e=0;e<this.buttons.length;e++){var s=this.buttons[e];if(t=s.update(),null!==t)break}return this.logoArkadium&&(this.logoArkadium.alpha=this.fader.fadeValue,this.logoArkadium.update()),this.version&&this.version.update(),this.fader.reached(1)&&(0!==P.eventChangeAdOnIdle&&(P.idleTimer-=P.elapsedTime,P.idleTimer<0&&(P.arenaHelper.sendEventChange(),P.idleTimer=Number.MAX_VALUE)),("click_start"==t||C.isPressed[32])&&(P.analyticsHelper.analytic&&P.analyticsHelper.analytic.startButtonClick(),P.analyticsHelper.analytic&&P.analyticsHelper.analytic.gamePanelShowed(),P.idleTimer=P.eventChangeAdOnIdle,P.hover=null,P.click=null,C.reset(32),this.fader.setFade(-.05),P.eventChangeAdOnTitlesClose&&P.arenaHelper.sendEventChange(),P.debug&&console.log("Titles: start fading out"))),!0},I.frameCount=0,I.paused=!1,I.requestQuit=!1,I.effects=null,I.score=0,I.highScore=0,I.timeLeft=0,I.options=null,I.levelMatches=0,I.STARTING=0,I.PLAYING=1,I.WON_LEVEL=2,I.FINAL_MESSAGE=3,I.NEXT_LEVEL=4,I.TIME_UP=5,I.NO_MOVES=6,I.GAME_WON=7,I.WAIT_DELAY=8,I.REMOVE_MSG_QUIT=9,I.QUIT_REQUEST=10,I.prototype.create=function(e,t){this.managers=e,this.numLevels=t,I.paused=!1,I.requestQuit=!1,I.score=0,I.levelMatches=0,I.timeLeft=P.timerStart,I.effects=new f,I.effects.create(this.managers.textures),this.level=0,this.help=null,this.confirm=null,this.bm=null,this.state=I.PLAYING,this.nextState=-1,this.delay=0,this.won=!1,P.arenaHelper.addPauseAndResumeActions(I.pauseGame.bind(this),I.resumeGame.bind(this)),this.managers.audio.play("snd_startSting"),P.showHelp&&this.showHelp(!0),P.analyticsHelper.analytic&&P.analyticsHelper.analytic.gameplayReady(this.level+1)},I.prototype.destroy=function(){this.bm&&(this.bm.destroy(),this.bm=null),this.world&&(this.world.destroy(),this.world=null),this.help&&(this.help.destroy(),this.help=null),this.confirm&&(this.confirm.destroy(),this.confirm=null),I.effects&&(I.effects.destroy(),I.effects=null),I.options&&(I.options.destroy(),I.options=null),this.managers=null},I.prototype.update=function(){var e=!0;if(I.frameCount++,this.confirm){if(this.confirm.update())return e;this.confirm.destroy(),this.confirm=null}if(this.help){if(this.help.update())return e;var t=this;this.help.remove(function(){t.help=null})}if(I.paused&&I.options)return I.options.update()?e:(I.options.remove(I.optionsDestroyed),e);I.requestQuit&&(I.requestQuit=!1,this.state=I.QUIT_REQUEST),P.puzzle.alpha<1&&(P.puzzle.alpha+=.2);var s,i=this.managers.locale.get("number_delimiter_string"),n=this.managers.locale.get("number_decimal_string");do{s=!1;var a=this.lastState!=this.state;switch(this.lastState=this.state,this.state){case I.PLAYING:if(a){var o=Math.min(this.level+1,this.numLevels);P.analyticsHelper.analytic&&P.analyticsHelper.analytic.levelStart(o),P.timeStartLevelMs=Date.now(),this.world=new E(this),this.world.create(this.managers,this.level),I.levelMatches=0,P.idleTimer=P.eventChangeAdOnIdle}this.world.update()?0!==P.eventChangeAdOnIdle&&(P.idleTimer-=P.elapsedTime,P.idleTimer<0&&(P.arenaHelper.sendEventChange(),P.idleTimer=Number.MAX_VALUE)):this.state=this.world.levelBeaten()?I.WON_LEVEL:this.world.timeUp()?I.TIME_UP:I.NO_MOVES;break;case I.WON_LEVEL:if(a){this.managers.audio.play("snd_endSting");var l=Math.round((Date.now()-P.timeStartLevelMs)/1e3),o=Math.min(this.level+1,this.numLevels);P.analyticsHelper.analytic&&P.analyticsHelper.analytic.levelEndFinished(o,l);var h=this.world.getLevelBonus();I.score+=h;var u=h>0?"+"+P.number2StringWithSeparator(h,!1,i,n):"",c=this.managers.locale.get("gvp_level_good_job_text_string")+"\n"+u;this.bm=new r,this.bm.create(P.fullUI,this.managers,c),this.bm.timeOut=1e3}this.world&&this.world.updateScore(),this.bm.update()||(this.state=I.NEXT_LEVEL,1===this.level&&0===P.repeatedGamesLeft&&P.playMidRollAd&&P.arenaHelper.requestMidroll());break;case I.NEXT_LEVEL:if(a){if(this.level++,this.level>this.numLevels-1){this.state=I.GAME_WON,this.won=!0,s=!0;break}this.world.destroy(),this.state=I.PLAYING,s=!0}break;case I.TIME_UP:this.managers.audio.play("snd_timeUp");var d=Date.now(),l=Math.round((d-P.timeStartLevelMs)/1e3),o=Math.min(this.level+1,this.numLevels),p=Math.round((d-P.timeStarted)/1e3);P.analyticsHelper.analytic&&(P.analyticsHelper.analytic.levelEndNotFinished(o,l),P.analyticsHelper.analytic.gameEndTimeOut(I.score,o,p)),this.bm=new r,I.score>I.highScore&&(I.highScore=I.score);var g=this.managers.locale.get("gvp_level_times_up_text_string")+"\n"+this.managers.locale.get("gvp_level_score_indication_text_string")+" "+P.number2StringWithSeparator(I.score,!1,i,n)+"\n"+this.managers.locale.get("gvp_high_score_indication_text_string")+" "+P.number2StringWithSeparator(I.highScore,!1,i,n);this.bm.create(P.fullUI,this.managers,g),this.world.puzzle.tornadoRemove=!0,this.state=I.FINAL_MESSAGE;break;case I.NO_MOVES:this.managers.audio.play("snd_error2"),this.bm=new r,I.score>I.highScore&&(I.highScore=I.score);var m=this.managers.locale.get("gvp_level_no_more_move_text_string")+"\n"+this.managers.locale.get("gvp_level_score_indication_text_string")+" "+P.number2StringWithSeparator(I.score,!1,i,n)+"\n"+this.managers.locale.get("gvp_high_score_indication_text_string")+" "+P.number2StringWithSeparator(I.highScore,!1,i,n);this.bm.create(P.fullUI,this.managers,m),this.world.puzzle.tornadoRemove=!0,this.state=I.FINAL_MESSAGE;break;case I.GAME_WON:this.bm=new r,I.score>I.highScore&&(I.highScore=I.score);var y=this.managers.locale.get("game_over_win_header_string")+"\n"+this.managers.locale.get("gvp_level_score_indication_text_string")+" "+P.number2StringWithSeparator(I.score,!1,i,n)+"\n"+this.managers.locale.get("gvp_high_score_indication_text_string")+" "+P.number2StringWithSeparator(I.highScore,!1,i,n);this.bm.create(P.fullUI,this.managers,y),this.state=I.FINAL_MESSAGE;break;case I.QUIT_REQUEST:if(a){this.bm=new r,I.score>I.highScore&&(I.highScore=I.score);var f=this.managers.locale.get("game_over_lose_header_string")+"\n"+this.managers.locale.get("gvp_level_score_indication_text_string")+" "+P.number2StringWithSeparator(I.score,!1,i,n)+"\n"+this.managers.locale.get("gvp_high_score_indication_text_string")+" "+P.number2StringWithSeparator(I.highScore,!1,i,n);this.bm.create(P.fullUI,this.managers,f),this.world.puzzle.tornadoRemove=!0,this.state=I.FINAL_MESSAGE}break;case I.FINAL_MESSAGE:if(a){var o=Math.min(this.level+1,this.numLevels),p=Math.round((Date.now()-P.timeStarted)/1e3);this.bm.timeOut=5e3,this.won?P.analyticsHelper.analytic&&P.analyticsHelper.analytic.gameEndWin(I.score,o,p):P.analyticsHelper.analytic&&P.analyticsHelper.analytic.gameEndLoss(I.score,o,p),P.analyticsHelper.analytic&&!P.quitConfirmed&&P.analyticsHelper.analytic.gameOverPanelShowed()}this.world&&(this.world.updateScore(),this.world.puzzle.tornadoRemove&&this.world.puzzle.update()),this.bm.update()||(this.bm.destroy(),this.bm=null,P.arenaHelper.sendGameEnd(I.highScore),this.delay=4e3,this.state=I.WAIT_DELAY,this.nextState=I.REMOVE_MSG_QUIT);break;case I.WAIT_DELAY:this.delay=Math.max(this.delay-P.elapsedTime,0),0===this.delay?(this.state=this.nextState,s=!0):this.bm&&this.bm.update();break;case I.REMOVE_MSG_QUIT:a&&this.bm&&this.bm.remove(this,"bm"),this.managers.audio.stopTune(),this.bm?this.bm.update()||(this.bm=null):(this.world.destroy(),e=!1)}}while(s);return I.effects.update(),e},I.prototype.showHelp=function(e){this.help=new l,this.help.create(this.managers,e),P.analyticsHelper.analytic&&P.analyticsHelper.analytic.helpShown()},I.prototype.showConfirm=function(e,t,s,i){this.confirm=new o,this.confirm.create(this,this.managers,e,t,s,i)},I.prototype.pauseToggle=function(){I.paused=!I.paused,P.debug&&console.log(I.paused?"Game.pauseToggle to true":"Game.pauseToggle to false"),I.paused?(I.options=new c,I.options.create(this,this.managers)):I.options&&(I.options.destroy(),I.options=null)},I.pauseGame=function(){P.debug&&console.log("Game.pauseGame"),this.managers.audio.visibilityMute(!0),I.paused=!0},I.resumeGame=function(){P.debug&&console.log("Game.resumeGame"),this.managers.audio.visibilityMute(!1),I.paused=null!==I.options},I.optionsDestroyed=function(){I.options=null,I.paused=!1},E.brighter=null,E.brighter2=null,E.prototype.create=function(e,t){this.managers=e,P.swipeEnabled=!0,E.SelectionPreviewX=504,E.SelectionPreviewY=206,E.SelectionPreviewBotY=216,E.brighter=new PIXI.filters.ColorMatrixFilter,E.brighter.brightness(1.5,!0),E.brighter2=new PIXI.filters.ColorMatrixFilter,E.brighter2.brightness(1.2,!0),this.bg=new n,this.bg.create(P.background,"gameAtlas","bg",this.managers.textures),this.bg.anchor.set(.5,1),this.bg.y=P.height/2/this.bg.parent.scale.y,this.icons=[],this.buttons=[],this.sprites=[],this.texts=[];var s=new k;s.create(this,this.managers,this.managers.data.get("levels").levels[t],this.managers.data.get("levels")),s.setTargetAngle(210*Math.PI/180,!0),s.adjustTargetAngle(90*Math.PI/180),this.puzzle=s,this.puzzleInput=new d,this.puzzleInput.create(this.managers,this.puzzle),this._createUI(),P.resized=!0,P.resizeConsumed=!1,this.lastMatchTime=-1,this.lastMatchType=-1,this.ignoreClick=null,this.reshuffled=!1,this.bm=null},E.prototype.destroy=function(){this.managers=null,this.bg&&(this.bg.destroy(),this.bg=null);var e;if(this.buttons){for(e=0;e<this.buttons.length;e++)this.buttons[e].destroy();this.buttons=null}if(this.icons){for(e=0;e<this.icons.length;e++)this.icons[e].destroy();this.icons=null}if(this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}this.puzzleInput&&(this.puzzleInput.destroy(),this.puzzleInput=null),this.puzzle&&(this.puzzle.destroy(),this.puzzle=null),E.brighter=null,E.brighter2=null,this.bm&&(this.bm.destroy(),this.bm=null),this.container1&&(this.container1.destroy(),this.container1=null),this.container2&&(this.container2.destroy(),this.container2=null),this.ignoreClick=null,this.game=null},E.prototype.update=function(){if(this._background(),this._userInput(),this.puzzle){if(!this._timerUpdate())return!1;if(!this._finishedOrStuck())return!1}var e=!this.puzzle.finished(!1);return this.container1&&this.container1.update(),this.container2&&this.container2.update(),this._userInterface()?!0:e},E.prototype.levelBeaten=function(){return this.puzzle?this.puzzle.finished(!1):!0},E.prototype.timeUp=function(){return I.timeLeft<=0},E.prototype.updateScore=function(){if(I.score>this.scoreText._visibleScore){var e=I.score-this.scoreText._visibleScore;e>25&&(e=Math.max(Math.floor(e/25),1)),this.scoreText._visibleScore+=e;var t=this.managers.locale.get("number_delimiter_string"),s=this.managers.locale.get("number_decimal_string");this.scoreText.text=P.number2StringWithSeparator(this.scoreText._visibleScore,!1,t,s)}},E.prototype._createUI=function(){var e=new h(h.TYPE_NOLATCH);e.create(P.topUI,"gameAtlas","pause_button",this.managers,516,63,!1,"pause_button","pause_button-rollover","pause_button-down","click_pause_event"),e.anchor.x=e.anchor.y=.5,e.scale.x=e.scale.y=1.5,e.sfx="snd_clickPlay",e.sfxHover="snd_rollOver",this.buttons.push(e);var t=new n;t.create(P.topUI,"gameAtlas","time icon",this.managers.textures,-540,63,!1),t.anchor.x=t.anchor.y=.5,t.scale.x=t.scale.y=1,this.icons.push(t);var s=new a("",P.textStyleSemiBold);s.create(P.topUI,-480,63,!1),s.anchor.y=.5,this.texts.push(s),this.timeText=s,t=new n,t.create(P.topUI,"gameAtlas","score icon",this.managers.textures,-150,63,!1),t.anchor.x=t.anchor.y=.5,t.scale.x=t.scale.y=1,this.icons.push(t);var i=this.managers.locale.get("number_delimiter_string"),r=this.managers.locale.get("number_decimal_string"),o=P.number2StringWithSeparator(I.score,!1,i,r);s=new a(o,P.textStyleSemiBold),s.create(P.topUI,-90,63,!1),s.anchor.y=.5,this.texts.push(s),this.scoreText=s,this.scoreText._visibleScore=I.score,e=new h(h.TYPE_BUTTON),e.create(P.bottomUI,"gameAtlas","arrow_lft",this.managers,-.43,.45,!0,"arrow_lft","arrow_lft-rollover","arrow_lft","click_left_event"),e.anchor.x=e.anchor.y=.5,e.scale.x=e.scale.y=.3,e.sfxHover="snd_rollOver",this.buttons.push(e),e=new h(h.TYPE_BUTTON),e.create(P.bottomUI,"gameAtlas","arrow_rgt",this.managers,.43,.45,!0,"arrow_rgt","arrow_rgt-rollover","arrow_rgt","click_right_event"),e.anchor.x=e.anchor.y=.5,e.scale.x=e.scale.y=.3,e.sfxHover="snd_rollOver",this.buttons.push(e);var l;l=new n,l.create(P.topUI,"gameAtlas","preview-tile-icon",this.managers.textures,E.SelectionPreviewX,E.SelectionPreviewY,!1),l.anchor.x=l.anchor.y=.5,l.scale.x=1.3,l.scale.y=1.2,l.alpha=.5,this.container1=l,l=new n,l.create(P.topUI,"gameAtlas","preview-tile-icon",this.managers.textures,E.SelectionPreviewX,E.SelectionPreviewY,!1),l.anchor.x=l.anchor.y=.5,l.scale.x=1.3,l.scale.y=1.2,l.alpha=.5,this.container2=l,l=new n,l.create(P.topUI,null,"cube_s1_1",this.managers.textures,E.SelectionPreviewX,E.SelectionPreviewY,!1),l.anchor.x=l.anchor.y=.5,l.scale.x=l.scale.y=S.scale/P.tileAssetScale,this.puzzleInput.createHoveredPiece(l),l=new n,l.create(P.topUI,null,"cube_s1_1",this.managers.textures,E.SelectionPreviewX,E.SelectionPreviewY,!1),l.y+=l.height,l.anchor.x=l.anchor.y=.5,l.scale.x=l.scale.y=S.scale/P.tileAssetScale,this.puzzleInput.createDroppedPiece(l),this.container1.visible=this.container2.visible=P.isPortrait?!1:!0,this.container2&&(this.container2.y=E.SelectionPreviewBotY=l.y)},E.prototype._timerUpdate=function(){if(this.bm)this.bm.update("bm");else if(!this.puzzle.tornadoRemove&&!I.paused){if(I.timeLeft-=P.elapsedTime,this.timeUp())return!1;var e=L.timeToString(I.timeLeft);this.timeText.text!=e&&(this.timeText.text=e),I.timeLeft/1e3<10&&(I.timeLeft%1e3<500?16711680!=this.timeText.tint&&(I.timeLeft/1e3<5&&this.managers.audio.play(["snd_timerWarning"]),this.timeText.tint=16711680):16777215!=this.timeText.tint&&(this.managers.audio.play(["snd_timerWarning"]),this.timeText.tint=16777215))}return!0},E.prototype._finishedOrStuck=function(){if(!this.puzzle.update()&&!this.puzzle.finished(!0)){if(this.reshuffled)return this.managers.audio.play(["snd_error1","snd_error2","snd_error3"]),!1;
if(!this.puzzle.overrideTileKey)for(;this.puzzle.puzzleLocked();)this._reshuffle()}return!0},E.prototype._background=function(){this.bg.y=P.height/2/this.bg.parent.scale.y,this.bg.update()},E.prototype._userInterface=function(){C.update(),this.container1.visible=this.container2.visible=P.isPortrait?!1:!0;for(var e,t=this.puzzleInput.update(),s=0;s<this.buttons.length&&(e=this.buttons[s].update(),null===e||void 0===e);s++);switch(e){case"click_pause_event":this.puzzleInput.removeHoverPiece(),this.game.pauseToggle();break;case"click_left_event":this.puzzleInput.removeHoverPiece(),this.puzzle.adjustTargetAngle(-90*Math.PI/180)&&this.managers.audio.play("snd_rotate"),P.eventChangeAdOnRotate&&P.arenaHelper.sendEventChange();break;case"click_right_event":this.puzzleInput.removeHoverPiece(),this.puzzle.adjustTargetAngle(90*Math.PI/180)&&this.managers.audio.play("snd_rotate"),P.eventChangeAdOnRotate&&P.arenaHelper.sendEventChange()}for(s=0;s<this.icons.length;s++)this.icons[s].update();for(s=0;s<this.sprites.length;s++)this.sprites[s].update();for(this.updateScore(),s=0;s<this.texts.length;s++)this.texts[s].update();return this.puzzleInput.showDropAndHoverPieces(),this.container1&&(this.container1.y=E.SelectionPreviewY),this.container2&&(this.container2.y=E.SelectionPreviewBotY),t},E.prototype._userInput=function(){if(!this.bm&&!this.puzzle.tornadoRemove){(P.swipe<0||C.isPressed[z.left_arrow]||C.isPressed[z.key_a]||C.isPressed[z.key_q])&&(this.puzzleInput.removeHoverPiece(),this.puzzle.adjustTargetAngle(-90*Math.PI/180)&&(this.managers.audio.play("snd_rotate"),P.eventChangeAdOnRotate&&P.arenaHelper.sendEventChange()),P.swipe=0,P.idleTimer=P.eventChangeAdOnIdle),(P.swipe>0||C.isPressed[z.right_arrow]||C.isPressed[z.key_d]||C.isPressed[z.key_e])&&(this.puzzleInput.removeHoverPiece(),this.puzzle.adjustTargetAngle(90*Math.PI/180)&&(this.managers.audio.play("snd_rotate"),P.eventChangeAdOnRotate&&P.arenaHelper.sendEventChange()),P.swipe=0,P.idleTimer=P.eventChangeAdOnIdle);var t;if(null!==P.mouseDown||null!==P.click||null===P.hover||isNaN(P.hover.x)||isNaN(P.hover.y)||!this.puzzle.contains(P.hover)||(t=this.puzzle.tilePicker(P.hover.x,P.hover.y),P.hover=null,t?this.puzzleInput.showHoveredPiece(t):this.puzzleInput.removeHoverPiece()),null!==P.click){P.idleTimer=P.eventChangeAdOnIdle;var s=!1;this.ignoreClick&&L.distanceBetween(this.ignoreClick,P.click)<10&&I.frameCount-this.ignoreClick.when<30&&(s=!0),s||(t=this.puzzle.tilePicker(P.click.x,P.click.y),t&&this.puzzleInput.clickedPiece(t)),P.click=null,this.ignoreClick=null}null!==P.mouseDown&&(P.idleTimer=P.eventChangeAdOnIdle,t=this.puzzle.tilePicker(P.mouseDown.x,P.mouseDown.y),this.ignoreClick=P.mouseDown,this.ignoreClick.when=I.frameCount,t&&this.puzzleInput.clickedPiece(t)&&(P.mouseDown=null)),P.testKeys&&C.isPressed[z.key_o]&&this.puzzle.overrideTiles(5,"s10"),P.testKeys&&C.isPressed[z.key_r]&&this._reshuffleClick(),P.testKeys&&C.isPressed[z.key_t]&&(this.puzzle.tornadoRemove=!0),P.testKeys&&C.isPressed[z.key_x]&&(I.timeLeft=1),P.testKeys&&(C.isPressed[z.key_v]||P.mouseDown&&P.mouseDown.x<30&&P.mouseDown.y<30)&&e.debugWindowData()}},E.prototype.destroySprite=function(e){var t=this.sprites.indexOf(e);-1!==t&&this.sprites.splice(t,1),e.destroy()},E.prototype._reshuffle=function(){this.managers.audio.playDelayed(["snd_reshuffle2"],1.5),this.puzzle.reshuffle()},E.prototype._reshuffleClick=function(){this.puzzleInput.removeHoverPiece(),this.reshuffled?this.managers.audio.play(["snd_error1","snd_error2","snd_error3"]):(this.managers.audio.play(["snd_reshuffle1"]),this.bm=new r,this.bm.create(P.fullUI,this.managers,"gvp_level_reshuffle_text_string",this._reshuffle,this),this.bm.timeOut=2500,this.reshuffleBtn&&(this.reshuffleBtn.visible=!1),P.analyticsHelper.analytic&&P.analyticsHelper.analytic.reshuffle())},E.prototype.getLevelBonus=function(){return this.puzzle.levelBonusValues?this.puzzle.levelBonusValues[this.game.level]:0},console.time("Game create"),P.arenaHelper=new x(null),(new P).createGame(),console.timeEnd("Game create")}();